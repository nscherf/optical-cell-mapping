(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    109727,       2852]
NotebookOptionsPosition[    103756,       2673]
NotebookOutlinePosition[    104167,       2691]
CellTagsIndexPosition[    104124,       2688]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
Cell-accurate optical mapping across the entire developing heart\
\>", "Title",
 CellChangeTimes->{{3.714798636167549*^9, 3.714798643920143*^9}, {
  3.714798712696336*^9, 
  3.714798738212171*^9}},ExpressionUUID->"b762ba58-c7eb-4449-a469-\
b4267d210c2e"],

Cell["\<\
First of all, we have to load the function definitions we will use throughout \
the analysis from an external file \[OpenCurlyDoubleQuote]./functions.m\
\[CloseCurlyDoubleQuote]. \
\>", "Text",
 CellChangeTimes->{{3.71479905160616*^9, 3.714799079753407*^9}, {
  3.714799184905587*^9, 
  3.714799191815287*^9}},ExpressionUUID->"8d435d17-8259-4d8e-ba23-\
a474c06a5afd"],

Cell[BoxData[
 RowBox[{"Get", "[", 
  RowBox[{
   RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<functions.m\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.714753565651903*^9, 3.714753627586282*^9}, {
  3.71475374240552*^9, 
  3.714753753852852*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"root", "=", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"Most", "[", 
    RowBox[{"FileNameSplit", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], "]"}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.7150940884334507`*^9, 
  3.715094130164023*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[CellGroupData[{

Cell["select dataset to analyze", "Subchapter",
 CellChangeTimes->{{3.7147987676717777`*^9, 
  3.714798774375169*^9}},ExpressionUUID->"5145de44-02c3-4d52-93fb-\
1ef3c5f6172a"],

Cell["\<\
We used the data from 5 different experiments for the analysis presented in \
the manuscript. An overview of the specific characteristics can be found in \
the datasheet: \[OpenCurlyQuote]datasets.xls\[CloseCurlyQuote].\
\>", "Text",
 CellChangeTimes->{{3.714799204745493*^9, 3.7147992066798887`*^9}, {
  3.714799676803508*^9, 
  3.714799758825612*^9}},ExpressionUUID->"a953296a-25fb-443a-aa30-\
29cfefc612bc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"overview", " ", "=", " ", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"root", "<>", "\"\</data/datasets.xls\>\""}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"TableForm", "[", "overview", "]"}]}], "Input",
 CellChangeTimes->{{3.655478939679381*^9, 3.655478943841887*^9}, {
  3.6744588416113253`*^9, 3.6744588422202806`*^9}, {3.714754406080118*^9, 
  3.714754418749305*^9}, {3.714754861757915*^9, 3.7147548618474913`*^9}, {
  3.714755147550641*^9, 3.714755168941865*^9}, {3.715094139523484*^9, 
  3.7150941415661383`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
Indicate number of dataset for analysis here. For illustration purposes we \
will use dataset 4:\
\>", "Text",
 CellChangeTimes->{{3.7147997690692167`*^9, 
  3.714799804298193*^9}},ExpressionUUID->"13df4298-b30e-424b-8116-\
cec97ec18649"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dataset", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{"dataset", "+", "1"}], "]"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6616988049646997`*^9, 3.661698805331214*^9}, {
   3.661699570047418*^9, 3.6616995702067003`*^9}, {3.661699685846887*^9, 
   3.661699685942478*^9}, {3.661699877141048*^9, 3.6616998772590837`*^9}, {
   3.661700038393881*^9, 3.661700038652042*^9}, {3.661700334737482*^9, 
   3.661700334855748*^9}, {3.661700605938519*^9, 3.661700606231571*^9}, 
   3.6619510546485367`*^9, {3.6619511802396307`*^9, 3.661951180413286*^9}, {
   3.661951331335569*^9, 3.661951331636476*^9}, {3.661951466820656*^9, 
   3.661951467548032*^9}, {3.662017798157402*^9, 3.662017798392653*^9}, 
   3.662294981013357*^9, {3.662295567511388*^9, 3.662295567637494*^9}, {
   3.662295755753685*^9, 3.662295756270338*^9}, {3.6622962877254333`*^9, 
   3.6622962879874353`*^9}, 3.662299466893277*^9, {3.667719223646413*^9, 
   3.667719223899783*^9}, {3.668839781746401*^9, 3.668839782050395*^9}, {
   3.66883989569734*^9, 3.668839895879416*^9}, {3.668839926511546*^9, 
   3.668839926734028*^9}, {3.668839978261392*^9, 3.668839978517087*^9}, {
   3.668840023660438*^9, 3.668840024156015*^9}, {3.668841525230241*^9, 
   3.6688415253632174`*^9}, 3.669356367489142*^9, {3.66935876991918*^9, 
   3.669358770061015*^9}, 3.669358897906798*^9, {3.669435010597662*^9, 
   3.669435012732415*^9}, 3.6694360073190947`*^9, {3.669437184435788*^9, 
   3.669437184617661*^9}, {3.669437338830986*^9, 3.6694373390053043`*^9}, {
   3.6694602405174417`*^9, 3.669460240594811*^9}, 3.669963041105193*^9, {
   3.669963135421245*^9, 3.669963135524159*^9}, {3.669963174354681*^9, 
   3.669963174506352*^9}, {3.671251083346183*^9, 3.671251083586445*^9}, {
   3.674458853996708*^9, 3.674458856530954*^9}, 3.6744804031035023`*^9, {
   3.674480634219165*^9, 3.6744806344267893`*^9}, {3.6744808012621403`*^9, 
   3.674480801549555*^9}, {3.674527016704975*^9, 3.674527017024848*^9}, {
   3.674828691983982*^9, 3.674828692103085*^9}, 3.6748291933172207`*^9, {
   3.674829722144554*^9, 3.674829772996612*^9}, 3.674829818865635*^9, {
   3.674834417030634*^9, 3.6748344171492147`*^9}, {3.6748350739103813`*^9, 
   3.674835074348338*^9}, {3.6748353954284267`*^9, 3.674835395794833*^9}, {
   3.6748357058655777`*^9, 3.674835706110931*^9}, {3.67483675921109*^9, 
   3.6748367594101677`*^9}, {3.674836906042531*^9, 3.6748369061455927`*^9}, {
   3.674837015978903*^9, 3.6748370162086697`*^9}, {3.6748371149521923`*^9, 
   3.674837115511373*^9}, {3.674837675853219*^9, 3.674837676090798*^9}, {
   3.674837711393977*^9, 3.674837711513997*^9}, {3.6749005088508463`*^9, 
   3.6749005091307697`*^9}, 3.674905087058902*^9, {3.674905199933023*^9, 
   3.6749052002113132`*^9}, {3.674905275755107*^9, 3.674905277000918*^9}, {
   3.6749164728209677`*^9, 3.6749164730845346`*^9}, 
   3.714755249668799*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["global parameters for analysis", "Subchapter",
 CellChangeTimes->{{3.6554776678244247`*^9, 3.655477674305852*^9}, {
  3.714755785830852*^9, 3.7147557971447144`*^9}, {3.714798846964857*^9, 
  3.7147988555556602`*^9}},ExpressionUUID->"b5f135e3-9246-4656-95a8-\
c81bce9573e7"],

Cell[CellGroupData[{

Cell["dataset-specific information", "Section",
 CellChangeTimes->{{3.714798816970935*^9, 
  3.71479882729669*^9}},ExpressionUUID->"5272a45c-a15b-4ad6-88c7-\
3de7806d3ac0"],

Cell[BoxData[{
 RowBox[{"fname", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "1"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"age", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "7"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"sampling", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "11"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"dx", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "12"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"samplingCorrectionFactor", " ", "=", " ", 
   RowBox[{"400", "/", "sampling"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.655479021511404*^9, 3.655479133277341*^9}, 
   3.655479168135984*^9, {3.655487371971097*^9, 3.655487372234848*^9}, 
   3.655489483208609*^9, 3.655490299425108*^9, {3.655490644672233*^9, 
   3.655490644774046*^9}, {3.655533232865612*^9, 3.655533244600911*^9}, {
   3.655533519790916*^9, 3.6555335198944483`*^9}, {3.655533906040166*^9, 
   3.655533906133751*^9}, 3.655534024866321*^9, {3.655534159555071*^9, 
   3.6555341596589003`*^9}, {3.655535031717915*^9, 3.655535032235477*^9}, {
   3.655535862268572*^9, 3.655535862426869*^9}, {3.655535942509951*^9, 
   3.655535942644422*^9}, {3.655536065345306*^9, 3.6555360655276937`*^9}, {
   3.6555361482341633`*^9, 3.6555361483368587`*^9}, {3.655536269765544*^9, 
   3.655536270075507*^9}, {3.6555415495606613`*^9, 3.655541549640798*^9}, {
   3.655546248986149*^9, 3.655546249255982*^9}, {3.655546528727294*^9, 
   3.655546528990411*^9}, 3.655547057565041*^9, {3.655547266361803*^9, 
   3.655547266479578*^9}, {3.655547885678088*^9, 3.655547885805414*^9}, {
   3.6557198439299793`*^9, 3.655719844087031*^9}, 3.6564044086060553`*^9, {
   3.656686420679265*^9, 3.6566864207797823`*^9}, {3.657345184367741*^9, 
   3.6573451845996*^9}, {3.657348396415759*^9, 3.6573483965119677`*^9}, {
   3.657541782503058*^9, 3.6575417826103077`*^9}, {3.657542616905013*^9, 
   3.6575426170398703`*^9}, {3.6575429891181993`*^9, 3.657542989225912*^9}, {
   3.6578692973927727`*^9, 3.657869299550892*^9}, {3.657869901031538*^9, 
   3.657869901149851*^9}, {3.657870185950344*^9, 3.6578701870062017`*^9}, {
   3.657870596827506*^9, 3.6578705969307547`*^9}, 3.65787202419201*^9, {
   3.657880200309387*^9, 3.657880201402659*^9}, {3.657961274646967*^9, 
   3.657961274764965*^9}, 3.6579616775648937`*^9, {3.657963748537416*^9, 
   3.657963748800256*^9}, {3.6579640548584023`*^9, 3.6579640550397377`*^9}, 
   3.6579643966343813`*^9, {3.657964787982163*^9, 3.657964788219819*^9}, {
   3.657979061944572*^9, 3.657979062094222*^9}, 3.657979162259286*^9, {
   3.658147338047896*^9, 3.6581473383659687`*^9}, {3.658147493417946*^9, 
   3.658147493560783*^9}, 3.658147638759336*^9, {3.6581478330411663`*^9, 
   3.6581478331988783`*^9}, {3.65821538082722*^9, 3.6582153931599827`*^9}, 
   3.6582192307680483`*^9, {3.658220365191001*^9, 3.658220365332737*^9}, {
   3.6582210079488087`*^9, 3.658221008348791*^9}, {3.658221655028468*^9, 
   3.658221655189927*^9}, {3.6582232741247177`*^9, 3.658223274442339*^9}, {
   3.65822964285907*^9, 3.658229643000409*^9}, {3.658230129188501*^9, 
   3.6582301293063307`*^9}, 3.658230303590469*^9, {3.658232817686871*^9, 
   3.658232817892416*^9}, 3.6584768211696243`*^9, {3.658478158331215*^9, 
   3.658478158443344*^9}, {3.658478301113508*^9, 3.658478301271511*^9}, {
   3.658478619567287*^9, 3.658478634334279*^9}, 3.658478678334684*^9, 
   3.658480635788706*^9, {3.6584833229658003`*^9, 3.658483323290544*^9}, 
   3.658487522364092*^9, {3.65848758445532*^9, 3.658487584598105*^9}, {
   3.6584884171436453`*^9, 3.65848841727075*^9}, {3.6584884778234158`*^9, 
   3.6584884779652967`*^9}, {3.658489370996216*^9, 3.65848937113943*^9}, {
   3.658489595695405*^9, 3.658489597764439*^9}, {3.658489696338751*^9, 
   3.658489696617964*^9}, {3.658492009634116*^9, 3.6584920096793003`*^9}, {
   3.6585846660710297`*^9, 3.658584666459688*^9}, {3.658585292452421*^9, 
   3.6585852925298557`*^9}, {3.658641070359269*^9, 3.658641076886517*^9}, {
   3.65864165133532*^9, 3.658641653470298*^9}, {3.658642007326476*^9, 
   3.658642007459906*^9}, {3.6586449508479767`*^9, 3.658644951699139*^9}, {
   3.658645465735037*^9, 3.658645465860588*^9}, {3.658645807779954*^9, 
   3.658645808242608*^9}, {3.6586461054593973`*^9, 3.658646105602231*^9}, {
   3.658646252248713*^9, 3.658646252398234*^9}, {3.6586464277626553`*^9, 
   3.658646438984563*^9}, {3.658646475842163*^9, 3.6586464760399303`*^9}, {
   3.658647174512472*^9, 3.6586471746871433`*^9}, {3.658648216620336*^9, 
   3.658648217242033*^9}, {3.6586482863783407`*^9, 3.658648286447935*^9}, 
   3.658648320671286*^9, {3.658648376543421*^9, 3.658648377325749*^9}, {
   3.65864855434483*^9, 3.658648554512006*^9}, 3.658653751876148*^9, {
   3.658653899701229*^9, 3.6586538998589697`*^9}, {3.6586540747667093`*^9, 
   3.65865407487011*^9}, {3.658658204802387*^9, 3.658658205272847*^9}, {
   3.658659165924616*^9, 3.658659166540614*^9}, {3.658660253437405*^9, 
   3.658660253675522*^9}, {3.658660368441811*^9, 3.6586603685352793`*^9}, {
   3.658660440119746*^9, 3.658660444189699*^9}, {3.6586605337874117`*^9, 
   3.6586605339068832`*^9}, {3.6586609079532824`*^9, 3.658660984781398*^9}, {
   3.658661222709853*^9, 3.658661223071912*^9}, {3.659076139006364*^9, 
   3.6590761408454857`*^9}, {3.660997322314293*^9, 3.660997333792224*^9}, {
   3.661000426499291*^9, 3.661000426583947*^9}, {3.661083041977661*^9, 
   3.6610830426181097`*^9}, {3.661148823202075*^9, 3.661148823328382*^9}, 
   3.6611561390514297`*^9, {3.661156350058941*^9, 3.6611563501925793`*^9}, {
   3.661156635184662*^9, 3.661156635334544*^9}, {3.66115690177173*^9, 
   3.661156902306993*^9}, {3.661157229700251*^9, 3.661157229762034*^9}, {
   3.661686252124406*^9, 3.6616862523611393`*^9}, {3.6616895007618303`*^9, 
   3.661689507670538*^9}, 3.6616899414082108`*^9, {3.661691585493167*^9, 
   3.661691585986661*^9}, {3.6616980800173807`*^9, 3.661698081343108*^9}, {
   3.661698611497982*^9, 3.6616986209107933`*^9}, {3.661698653631297*^9, 
   3.661698653956615*^9}, {3.661698783858286*^9, 3.661698786101461*^9}, {
   3.6743717081272707`*^9, 3.674371708182232*^9}, {3.674460314580468*^9, 
   3.674460320395936*^9}, {3.6761887911742573`*^9, 3.6761888043279533`*^9}, {
   3.7147553309681807`*^9, 3.7147554873603983`*^9}, {3.714755592486487*^9, 
   3.71475563782023*^9}, {3.714755667982114*^9, 3.714755777847192*^9}, 
   3.7147558356960573`*^9, {3.714755930660054*^9, 3.7147559665389977`*^9}, 
   3.714799816502062*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["settings for import and export", "Section",
 CellChangeTimes->{{3.714798830927537*^9, 
  3.714798844282794*^9}},ExpressionUUID->"7058de77-6701-4429-86ab-\
33304b6e104d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"directory", " ", "prefix", " ", "for", " ", "import"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"prefix", " ", "=", " ", 
     RowBox[{"root", "<>", "\"\</results/\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Ca", " ", "signals", " ", "per", " ", "cell", " ", "from", " ", "HDF5", 
     " ", "file"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"in", " ", "=", 
     RowBox[{
     "prefix", "<>", "\"\<myl7-GCaMP5G-from-processed-labels/\>\"", "<>", 
      "fname", "<>", "\"\<-curated-signal.h5\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "labelled", " ", "volume", " ", "of", " ", "detected", " ", "cells"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"map", " ", "=", " ", 
     RowBox[{
     "prefix", "<>", "\"\<myl7-H2A-processed-labels/\>\"", "<>", "fname", 
      "<>", "\"\<-curated-labels.tif\>\""}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "coordinates", " ", "of", " ", "manually", " ", "extracted", " ", 
     "midline"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mline", " ", "=", " ", 
     RowBox[{
     "prefix", "<>", "\"\<extracted-midline/\>\"", "<>", "fname", "<>", 
      "\"\<-midline.m\>\""}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7147558009952583`*^9, 3.714755918798725*^9}, {
   3.714756001531382*^9, 3.7147560132343807`*^9}, 3.714798885787745*^9, {
   3.715094196677239*^9, 3.7150942422278*^9}, {3.715094349599399*^9, 
   3.715094420859765*^9}, {3.715094634608032*^9, 
   3.715094639553718*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["general parameters", "Section",
 CellChangeTimes->{{3.714798868879168*^9, 
  3.7147988770398684`*^9}},ExpressionUUID->"daaf982b-73f6-46b4-be4d-\
bcd3e4a1cec5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "frequency", " ", "cutoff", " ", "for", " ", "lowpass", " ", "filter"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"freqCut", "=", "0.06"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"arbitrary", " ", "'"}], 
     RowBox[{"zero", "'"}], " ", "point", " ", "for", " ", "all", " ", "time",
      " ", "series"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"startPoint", "=", "140"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"settings", " ", "for", " ", "exported", " ", "graphics"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"maxRes", "=", "600"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imsize", "=", " ", "600"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imres", " ", "=", " ", "300"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "color", " ", "range", " ", "clipping", " ", "for", " ", "plotting"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"minDelay", "=", "0.0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"maxDelay", " ", "=", " ", "0.2"}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"maxMetricSpeed", "=", "4"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.655479021511404*^9, 3.655479133277341*^9}, 
   3.655479168135984*^9, {3.655487371971097*^9, 3.655487372234848*^9}, 
   3.655489483208609*^9, 3.655490299425108*^9, {3.655490644672233*^9, 
   3.655490644774046*^9}, {3.655533232865612*^9, 3.655533244600911*^9}, {
   3.655533519790916*^9, 3.6555335198944483`*^9}, {3.655533906040166*^9, 
   3.655533906133751*^9}, 3.655534024866321*^9, {3.655534159555071*^9, 
   3.6555341596589003`*^9}, {3.655535031717915*^9, 3.655535032235477*^9}, {
   3.655535862268572*^9, 3.655535862426869*^9}, {3.655535942509951*^9, 
   3.655535942644422*^9}, {3.655536065345306*^9, 3.6555360655276937`*^9}, {
   3.6555361482341633`*^9, 3.6555361483368587`*^9}, {3.655536269765544*^9, 
   3.655536270075507*^9}, {3.6555415495606613`*^9, 3.655541549640798*^9}, {
   3.655546248986149*^9, 3.655546249255982*^9}, {3.655546528727294*^9, 
   3.655546528990411*^9}, 3.655547057565041*^9, {3.655547266361803*^9, 
   3.655547266479578*^9}, {3.655547885678088*^9, 3.655547885805414*^9}, {
   3.6557198439299793`*^9, 3.655719844087031*^9}, 3.6564044086060553`*^9, {
   3.656686420679265*^9, 3.6566864207797823`*^9}, {3.657345184367741*^9, 
   3.6573451845996*^9}, {3.657348396415759*^9, 3.6573483965119677`*^9}, {
   3.657541782503058*^9, 3.6575417826103077`*^9}, {3.657542616905013*^9, 
   3.6575426170398703`*^9}, {3.6575429891181993`*^9, 3.657542989225912*^9}, {
   3.6578692973927727`*^9, 3.657869299550892*^9}, {3.657869901031538*^9, 
   3.657869901149851*^9}, {3.657870185950344*^9, 3.6578701870062017`*^9}, {
   3.657870596827506*^9, 3.6578705969307547`*^9}, 3.65787202419201*^9, {
   3.657880200309387*^9, 3.657880201402659*^9}, {3.657961274646967*^9, 
   3.657961274764965*^9}, 3.6579616775648937`*^9, {3.657963748537416*^9, 
   3.657963748800256*^9}, {3.6579640548584023`*^9, 3.6579640550397377`*^9}, 
   3.6579643966343813`*^9, {3.657964787982163*^9, 3.657964788219819*^9}, {
   3.657979061944572*^9, 3.657979062094222*^9}, 3.657979162259286*^9, {
   3.658147338047896*^9, 3.6581473383659687`*^9}, {3.658147493417946*^9, 
   3.658147493560783*^9}, 3.658147638759336*^9, {3.6581478330411663`*^9, 
   3.6581478331988783`*^9}, {3.65821538082722*^9, 3.6582153931599827`*^9}, 
   3.6582192307680483`*^9, {3.658220365191001*^9, 3.658220365332737*^9}, {
   3.6582210079488087`*^9, 3.658221008348791*^9}, {3.658221655028468*^9, 
   3.658221655189927*^9}, {3.6582232741247177`*^9, 3.658223274442339*^9}, {
   3.65822964285907*^9, 3.658229643000409*^9}, {3.658230129188501*^9, 
   3.6582301293063307`*^9}, 3.658230303590469*^9, {3.658232817686871*^9, 
   3.658232817892416*^9}, 3.6584768211696243`*^9, {3.658478158331215*^9, 
   3.658478158443344*^9}, {3.658478301113508*^9, 3.658478301271511*^9}, {
   3.658478619567287*^9, 3.658478634334279*^9}, 3.658478678334684*^9, 
   3.658480635788706*^9, {3.6584833229658003`*^9, 3.658483323290544*^9}, 
   3.658487522364092*^9, {3.65848758445532*^9, 3.658487584598105*^9}, {
   3.6584884171436453`*^9, 3.65848841727075*^9}, {3.6584884778234158`*^9, 
   3.6584884779652967`*^9}, {3.658489370996216*^9, 3.65848937113943*^9}, {
   3.658489595695405*^9, 3.658489597764439*^9}, {3.658489696338751*^9, 
   3.658489696617964*^9}, {3.658492009634116*^9, 3.6584920096793003`*^9}, {
   3.6585846660710297`*^9, 3.658584666459688*^9}, {3.658585292452421*^9, 
   3.6585852925298557`*^9}, {3.658641070359269*^9, 3.658641076886517*^9}, {
   3.65864165133532*^9, 3.658641653470298*^9}, {3.658642007326476*^9, 
   3.658642007459906*^9}, {3.6586449508479767`*^9, 3.658644951699139*^9}, {
   3.658645465735037*^9, 3.658645465860588*^9}, {3.658645807779954*^9, 
   3.658645808242608*^9}, {3.6586461054593973`*^9, 3.658646105602231*^9}, {
   3.658646252248713*^9, 3.658646252398234*^9}, {3.6586464277626553`*^9, 
   3.658646438984563*^9}, {3.658646475842163*^9, 3.6586464760399303`*^9}, {
   3.658647174512472*^9, 3.6586471746871433`*^9}, {3.658648216620336*^9, 
   3.658648217242033*^9}, {3.6586482863783407`*^9, 3.658648286447935*^9}, 
   3.658648320671286*^9, {3.658648376543421*^9, 3.658648377325749*^9}, {
   3.65864855434483*^9, 3.658648554512006*^9}, 3.658653751876148*^9, {
   3.658653899701229*^9, 3.6586538998589697`*^9}, {3.6586540747667093`*^9, 
   3.65865407487011*^9}, {3.658658204802387*^9, 3.658658205272847*^9}, {
   3.658659165924616*^9, 3.658659166540614*^9}, {3.658660253437405*^9, 
   3.658660253675522*^9}, {3.658660368441811*^9, 3.6586603685352793`*^9}, {
   3.658660440119746*^9, 3.658660444189699*^9}, {3.6586605337874117`*^9, 
   3.6586605339068832`*^9}, {3.6586609079532824`*^9, 3.658660984781398*^9}, {
   3.658661222709853*^9, 3.658661223071912*^9}, {3.659076139006364*^9, 
   3.6590761408454857`*^9}, {3.660997322314293*^9, 3.660997333792224*^9}, {
   3.661000426499291*^9, 3.661000426583947*^9}, {3.661083041977661*^9, 
   3.6610830426181097`*^9}, {3.661148823202075*^9, 3.661148823328382*^9}, 
   3.6611561390514297`*^9, {3.661156350058941*^9, 3.6611563501925793`*^9}, {
   3.661156635184662*^9, 3.661156635334544*^9}, {3.66115690177173*^9, 
   3.661156902306993*^9}, {3.661157229700251*^9, 3.661157229762034*^9}, {
   3.661686252124406*^9, 3.6616862523611393`*^9}, {3.6616895007618303`*^9, 
   3.661689507670538*^9}, 3.6616899414082108`*^9, {3.661691585493167*^9, 
   3.661691585986661*^9}, {3.6616980800173807`*^9, 3.661698081343108*^9}, {
   3.661698611497982*^9, 3.6616986209107933`*^9}, {3.661698653631297*^9, 
   3.661698653956615*^9}, {3.661698783858286*^9, 3.661698786101461*^9}, {
   3.6743717081272707`*^9, 3.674371708182232*^9}, {3.674460314580468*^9, 
   3.674460320395936*^9}, {3.6761887911742573`*^9, 3.6761888043279533`*^9}, {
   3.7147553309681807`*^9, 3.7147554873603983`*^9}, {3.714755592486487*^9, 
   3.71475563782023*^9}, {3.714755667982114*^9, 3.714755777847192*^9}, 
   3.7147558356960573`*^9, {3.714755930660054*^9, 3.714755996874426*^9}, {
   3.714756672414266*^9, 3.7147567661596603`*^9}, 3.714757078332003*^9, {
   3.714758081453981*^9, 3.714758097886653*^9}, {3.7147988798184967`*^9, 
   3.714798891764056*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["data analysis and visualization", "Subchapter",
 CellChangeTimes->{{3.714798897301742*^9, 3.714798905922229*^9}, {
  3.7148018843635178`*^9, 
  3.7148018863425713`*^9}},ExpressionUUID->"b3402647-0039-44ff-a955-\
e7362baa34f8"],

Cell[CellGroupData[{

Cell["import position and Ca signals for each cell", "Section",
 CellChangeTimes->{{3.714798914835228*^9, 3.71479891797869*^9}, {
  3.714799901334991*^9, 
  3.714799925419663*^9}},ExpressionUUID->"c668e6b5-43b9-4dcb-9dab-\
9d84776c9fc8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"names", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"in", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\""}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ns", " ", "=", " ", 
   RowBox[{"Length", "[", "names", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"series", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{"in", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", "n"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", " ", "1", ",", " ", "ns", ",", "1"}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"heart", "=", 
   RowBox[{"Import", "[", "map", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"img", "=", 
   RowBox[{"Image3D", "[", 
    RowBox[{"heart", ",", "\"\<Bit16\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lab", " ", "=", " ", 
   RowBox[{"ComponentMeasurements", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ImageData", "[", 
        RowBox[{"img", ",", "\"\<Bit16\>\""}], "]"}], ",", "img"}], "}"}], 
     ",", 
     RowBox[{"{", "\"\<Label\>\"", "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cnts", " ", "=", " ", 
   RowBox[{"ComponentMeasurements", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ImageData", "[", 
        RowBox[{"img", ",", "\"\<Bit16\>\""}], "]"}], ",", "img"}], "}"}], 
     ",", 
     RowBox[{"{", "\"\<Centroid\>\"", "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sizes", " ", "=", " ", 
   RowBox[{"ComponentMeasurements", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ImageData", "[", 
        RowBox[{"img", ",", "\"\<Bit16\>\""}], "]"}], ",", "img"}], "}"}], 
     ",", 
     RowBox[{"{", "\"\<Count\>\"", "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pts", "=", 
   RowBox[{"Join", "@@", 
    RowBox[{"(", 
     RowBox[{"Last", "/@", "cnts"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pts2", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "*", 
      RowBox[{"{", 
       RowBox[{"dx", ",", "dx", ",", "1"}], "}"}]}], "&"}], "/@", "pts"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"series", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"RotateLeft", "[", 
      RowBox[{"#", ",", "startPoint"}], "]"}], "&"}], "/@", "series"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ids", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"ToExpression", "[", 
      RowBox[{"StringDrop", "[", 
       RowBox[{"#", ",", "3"}], "]"}], "]"}], "&"}], "/@", "names"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"series", "=", 
   RowBox[{"Last", "/@", 
    RowBox[{"SortBy", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"ids", ",", "series"}], "}"}], "]"}], ",", "First"}], 
     "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stdTransform", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
    "prefix", "<>", "\"\<standard-view-transforms/\>\"", "<>", "fname", "<>", 
     "\"\<-standardTransform.m\>\""}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6554777135070953`*^9, 3.6554777232097397`*^9}, {
   3.655479245674204*^9, 3.6554792615614*^9}, 3.655487398780986*^9, {
   3.658478329966675*^9, 3.658478401381905*^9}, {3.6586609640409737`*^9, 
   3.658660968031726*^9}, {3.658661231493938*^9, 3.6586612318714027`*^9}, {
   3.661000523684219*^9, 3.661000523889441*^9}, 3.661000583676567*^9, 
   3.661000733243688*^9, {3.66115553423967*^9, 3.661155553104319*^9}, {
   3.6688373204136677`*^9, 3.6688373263768167`*^9}, {3.674458971630077*^9, 
   3.674458973429183*^9}, {3.674834667924857*^9, 3.674834672869282*^9}, {
   3.7147560215867863`*^9, 3.714756043690292*^9}, {3.714756075481628*^9, 
   3.714756104070279*^9}, {3.715094440206498*^9, 3.715094501536394*^9}, 
   3.715094658275865*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["pre-process calcium signals", "Section",
 CellChangeTimes->{{3.7147989410943832`*^9, 
  3.714798951088229*^9}},ExpressionUUID->"aefb8eb7-fa45-4120-a750-\
5de5a0a08c17"],

Cell["\<\
Here, we process the raw GCaMP signals using lowpass filtering, extract the \
features of interest, and also discard time series where SNR is too low \
(defined as an outlier from the SNR statistics over all time series from this \
experiment)\
\>", "Text",
 CellChangeTimes->{{3.715094696407812*^9, 
  3.715094795699869*^9}},ExpressionUUID->"67cb72a6-f14d-4726-afd9-\
1a7372d42fe8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"res", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"smoothSeries", "[", "#", "]"}], "&"}], "/@", "series"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shifted", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"shift2min", "[", 
      RowBox[{"smoothSeries", "[", "#", "]"}], "]"}], "&"}], "/@", 
    "series"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"onsetAP", ",", "slopes", ",", "SNR"}], "}"}], "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"extractFeatures", "/@", "series"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cutoffSNR", " ", "=", " ", 
   RowBox[{
    RowBox[{"1.5", " ", 
     RowBox[{"InterquartileRange", "[", "SNR", "]"}]}], "+", 
    RowBox[{"Quantile", "[", 
     RowBox[{"SNR", ",", " ", "0.75"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"del", "=", 
   RowBox[{"Position", "[", 
    RowBox[{"SNR", ",", " ", 
     RowBox[{"z_", "/;", 
      RowBox[{"z", ">", "cutoffSNR"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"series", "=", 
   RowBox[{"Delete", "[", 
    RowBox[{"series", ",", "del"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pts2", " ", "=", " ", 
   RowBox[{"Delete", "[", 
    RowBox[{"pts2", ",", "del"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.655477883181121*^9, 3.655477883358304*^9}, {
   3.6554805792274847`*^9, 3.65548058950598*^9}, {3.658478416699357*^9, 
   3.658478416931917*^9}, {3.65848353750935*^9, 3.658483569458721*^9}, 
   3.661000720898465*^9, {3.661155561804105*^9, 3.6611556339479637`*^9}, 
   3.6616982626787357`*^9, {3.661698564099627*^9, 3.661698566337749*^9}, 
   3.674834847214044*^9, 3.6748355717033377`*^9, 3.674900785196774*^9, {
   3.676188254246505*^9, 
   3.676188257389378*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"onsetAP", ",", "slopes", ",", "SNR"}], "}"}], "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"extractFeatures", "/@", "series"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"res", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"smoothSeries", "[", "#", "]"}], "&"}], "/@", "series"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"shifted", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"shift2min", "[", 
      RowBox[{"smoothSeries", "[", "#", "]"}], "]"}], "&"}], "/@", 
    "series"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tAct", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"getActivationTime", "[", "#", "]"}], "&"}], "/@", "series"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"riseTime", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"getRiseTime", "[", "#", "]"}], "&"}], "/@", "series"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.6584772583005753`*^9, {3.658585303004656*^9, 3.658585303178588*^9}, {
   3.6611473197247267`*^9, 3.6611473372011623`*^9}, {3.661149469773375*^9, 
   3.661149480171771*^9}, {3.661152390038178*^9, 3.661152398993067*^9}, {
   3.661153381793466*^9, 3.661153388391382*^9}, {3.6611555564304857`*^9, 
   3.661155567142055*^9}, {3.714756153002902*^9, 
   3.7147561535343018`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["compute nearest-neighbor graph from cell positions", "Section",
 CellChangeTimes->{{3.714798962896367*^9, 
  3.714798976868104*^9}},ExpressionUUID->"7bd9a3ba-85a0-47a5-9d8d-\
647e4dcc5a14"],

Cell["\<\
We compute the nearest neighbor graph from local flat projections of cell \
positions around each cell.\
\>", "Text",
 CellChangeTimes->{{3.7150949116986847`*^9, 3.7150949859108667`*^9}, {
  3.7150950173587646`*^9, 
  3.715095022184816*^9}},ExpressionUUID->"ecb512a8-81f9-4112-b7e6-\
8341a95600b3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nnfun", " ", "=", " ", 
   RowBox[{"Nearest", "[", "pts2", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"myEdges", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"localTopology", "[", 
       RowBox[{"#", ",", "pts2", ",", "nnfun"}], "]"}], "&"}], "/@", "pts2"}],
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vertexIDs", "=", 
   RowBox[{"Range", "[", 
    RowBox[{"Length", "[", "pts2", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"edgeDelays", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"onsetAP", "[", 
        RowBox[{"[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
       RowBox[{"onsetAP", "[", 
        RowBox[{"[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "]"}], "&"}], "/@", 
    "myEdges"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"myGraph", "=", 
   RowBox[{"Graph", "[", 
    RowBox[{"vertexIDs", ",", " ", 
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{"Sort", "/@", "myEdges"}], "]"}], ",", " ", 
     RowBox[{"VertexCoordinates", "\[Rule]", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", "#1"}], "&"}], ",", 
        "pts2"}], "]"}]}], ",", 
     RowBox[{"EdgeStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{
        RowBox[{"AbsoluteThickness", "[", "1", "]"}], ",", "LightGray"}], 
       "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.655478038313387*^9, 3.655478052570207*^9}, {
   3.658640810280506*^9, 3.658640810537683*^9}, 3.6586462072401876`*^9, {
   3.714756173505776*^9, 
   3.714756174579348*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
The z depth of each cell is used to fade the edges into the background to \
increase depth perception in the 3D visualization of the graph.\
\>", "Text",
 CellChangeTimes->{
  3.7150950357924223`*^9, {3.715095094757313*^9, 
   3.715095143881097*^9}},ExpressionUUID->"70b7bebd-faac-4743-ab9e-\
b1cd4c6592f9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"maxZ", ",", " ", "minZ"}], "}"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "pts2"}], "]"}], ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "pts2"}], "]"}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"edges", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"GrayLevel", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", "minZ"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"maxZ", "-", "minZ"}], ")"}]}], "]"}], ",", 
       RowBox[{"AbsoluteThickness", "[", "1", "]"}], ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{"myEdges", "/.", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", "#1"}], "&"}], ",", 
        "pts2"}], "]"}]}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.655482883642618*^9, 3.655483086125012*^9}, {
  3.655483123033209*^9, 3.655483142891944*^9}, {3.65548319577076*^9, 
  3.655483239928317*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cells", " ", "=", " ", "pts2"}], ";"}]], "Input",
 CellChangeTimes->{{3.655488142715345*^9, 
  3.655488145226264*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
The graph distance matrix stores the shortest distance along the graph \
between any pair of vertices.\
\>", "Text",
 CellChangeTimes->{{3.715095150396048*^9, 
  3.715095203555633*^9}},ExpressionUUID->"58004654-d28a-40d6-9953-\
02c7388635dd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"spfun", "=", 
   RowBox[{"FindShortestPath", "[", 
    RowBox[{"myGraph", ",", "All", ",", "All"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gdistMat", " ", "=", " ", 
   RowBox[{"GraphDistanceMatrix", "[", "myGraph", "]"}]}], ";"}]}], "Input",Ex\
pressionUUID->"00000000-0000-0000-0000-000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["compute curved cylindrical coordinate system", "Section",
 CellChangeTimes->{{3.7147989873033943`*^9, 
  3.7147989978226624`*^9}},ExpressionUUID->"6f4e59f5-09df-4c43-94af-\
43a5b63cf5a9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"xmin", ",", "xmax"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ymin", ",", "ymax"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"zmin", ",", "zmax"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Min", "[", "#", "]"}], ",", 
       RowBox[{"Max", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
    RowBox[{"Transpose", "[", "pts2", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.657264228489072*^9, 3.657264262224662*^9}, 
   3.6584837573919783`*^9, {3.715094894184574*^9, 
   3.715094899978539*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["Import the manually extracted midline (a polyline).", "Text",
 CellChangeTimes->{{3.715095219541164*^9, 
  3.7150952396578217`*^9}},ExpressionUUID->"5cf11721-2976-4bac-9d7d-\
758a4aedfead"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ctrlPts", "=", 
   RowBox[{"Import", "[", "mline", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6572954487036133`*^9, 3.657295454903549*^9}, 
   3.658483759693294*^9, 3.7150948927591267`*^9, {3.715095210958132*^9, 
   3.715095211449518*^9}},ExpressionUUID->"abacca1a-65be-4e16-bbc9-\
edeb0522f938"],

Cell["\<\
Computing the spline interpolation of the manually annotated control points \
of the midline (parameterized in [0,1]).
(Note: The spline degree can influences the computation of the Frenet frame, \
we set it to 4 for all experiments in the paper.)\
\>", "Text",
 CellChangeTimes->{{3.657377916602333*^9, 3.657377931959901*^9}, {
  3.714799013094154*^9, 3.7147990447804527`*^9}, {3.715095700299259*^9, 
  3.7150957324316053`*^9}, {3.715095942166177*^9, 
  3.715095955018421*^9}},ExpressionUUID->"6be9cbc2-ef1f-4724-a474-\
1cd5caa994a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"xi", ",", "yi", ",", "zi"}], "}"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"BSplineFunction", "[", 
      RowBox[{"#", ",", 
       RowBox[{"SplineDegree", "\[Rule]", "4"}]}], "]"}], "&"}], "/@", 
    RowBox[{"Transpose", "[", "ctrlPts", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.657269517979279*^9, 3.657269550266037*^9}, {
  3.657296029188098*^9, 3.6572960783076487`*^9}, {3.657350533158608*^9, 
  3.6573505335466547`*^9}, {3.657350629524534*^9, 3.6573506296750717`*^9}, {
  3.6573778458790827`*^9, 3.657377872937512*^9}, {3.6575210593507347`*^9, 
  3.6575210594746313`*^9}, {3.657521097299584*^9, 3.657521137370418*^9}, {
  3.657531392701303*^9, 3.65753139286194*^9}, {3.657531515387484*^9, 
  3.657531515519351*^9}, {3.657532749390133*^9, 3.657532753944943*^9}, {
  3.658658914173195*^9, 
  3.65865891427488*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["Computing the arclength along curcve...", "Text",
 CellChangeTimes->{{3.715095258819854*^9, 3.7150952755228577`*^9}, {
  3.715095412913525*^9, 3.715095414963674*^9}, {3.7150959612803087`*^9, 
  3.7150959664649057`*^9}},ExpressionUUID->"aceb7826-e4d1-44a2-9252-\
4a9c5d82075b"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "s", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s", "[", "t_", "]"}], ":=", 
  RowBox[{"NIntegrate", "[", 
   RowBox[{
    RowBox[{"Sqrt", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"xi", "'"}], "[", "t0", "]"}], ")"}], "^", "2"}], " ", "+", 
      " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"yi", "'"}], "[", "t0", "]"}], ")"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"zi", "'"}], "[", "t0", "]"}], ")"}], "^", "2"}]}], "]"}], 
    ",", 
    RowBox[{"{", 
     RowBox[{"t0", ",", "0", ",", "t"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.657345277082823*^9, 3.657345431926962*^9}, {
   3.65734546629952*^9, 3.6573455311241426`*^9}, 3.657345635636816*^9, 
   3.657345869112986*^9, {3.657532778179968*^9, 3.657532783442094*^9}, {
   3.71509598026678*^9, 
   3.715095989948963*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"smin", "=", 
   RowBox[{"s", "[", "0", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"smax", " ", "=", " ", 
   RowBox[{
    RowBox[{"s", "[", "1.", "]"}], "-", "0.001"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.657532910691523*^9, 3.657532913820859*^9}, 
   3.714756191230879*^9, {3.715095250176949*^9, 
   3.715095250366144*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
Interpolated mapping from normalized parameters in [0,1]  to corresponding \
arclength along the curve:\
\>", "Text",
 CellChangeTimes->{{3.715095280063738*^9, 3.715095294546554*^9}, {
  3.715095635519095*^9, 3.715095658200262*^9}, {3.7150960279562273`*^9, 
  3.715096102611858*^9}},ExpressionUUID->"28b0e48e-cc6f-40c4-b6a9-\
63b42373715b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ipol", "=", 
   RowBox[{"ListInterpolation", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "t", "}"}], ",", 
        RowBox[{"s", "[", "t", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "1", ",", "0.05"}], "}"}]}], "]"}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.657345818128326*^9, 3.657345841485382*^9}, {
   3.6573459420897284`*^9, 3.657345965124411*^9}, {3.657346041760828*^9, 
   3.657346060879562*^9}, 3.657532791982586*^9, 3.7150959978462763`*^9, 
   3.7150960668750677`*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["Compute inverse parametrization (from arclength to [0,1]):", "Text",
 CellChangeTimes->{{3.715095317045143*^9, 3.715095347889144*^9}, {
  3.715095418594821*^9, 3.715095425173267*^9}, {3.715095660843645*^9, 
  3.71509568336121*^9}},ExpressionUUID->"0a8f101f-fd5d-4846-95d1-\
360db02b0474"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "t", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t", "[", "s_", "]"}], ":=", 
  RowBox[{
   RowBox[{"InverseFunction", "[", "ipol", "]"}], "[", "s", "]"}]}]}], "Input",\

 CellChangeTimes->{{3.6573460636659203`*^9, 3.657346093806614*^9}, {
  3.6581419849927588`*^9, 
  3.65814198774489*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
These mappings can be used to compute and equidistant (with respect to the \
arclength) parametrization of the midline in [0,1]\
\>", "Text",
 CellChangeTimes->{{3.71509620665878*^9, 3.715096226667891*^9}, {
  3.7150968395157843`*^9, 3.715096854413322*^9}, {3.7150968889526157`*^9, 
  3.7150969044790897`*^9}},ExpressionUUID->"1a590cb6-bb8b-4c76-8488-\
9af2c70d2bf3"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "xint", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xint", "[", "s_", "]"}], ":=", 
  RowBox[{"Chop", "[", 
   RowBox[{"xi", "[", 
    RowBox[{"t", "[", 
     RowBox[{"s", "*", "smax"}], "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "yint", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yint", "[", "s_", "]"}], ":=", 
  RowBox[{"Chop", "[", 
   RowBox[{"yi", "[", 
    RowBox[{"t", "[", 
     RowBox[{"s", "*", "smax"}], "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "zint", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zint", "[", "s_", "]"}], ":=", 
  RowBox[{"Chop", "[", 
   RowBox[{"zi", "[", 
    RowBox[{"t", "[", 
     RowBox[{"s", "*", "smax"}], "]"}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.657532795491921*^9, 3.657532846916621*^9}, {
  3.657532985285966*^9, 3.657532987001934*^9}, {3.657533020441791*^9, 
  3.65753303592013*^9}, {3.6575330948184137`*^9, 
  3.657533124107502*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"xint2", "=", 
   RowBox[{"BSplineFunction", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"xint", "[", "s", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"s", ",", "0", ",", "1", ",", "0.01"}], "}"}]}], "]"}], ",", 
     RowBox[{"SplineDegree", "\[Rule]", "4"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yint2", "=", 
   RowBox[{"BSplineFunction", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"yint", "[", "s", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"s", ",", "0", ",", "1", ",", "0.01"}], "}"}]}], "]"}], ",", 
     RowBox[{"SplineDegree", "\[Rule]", "4"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zint2", "=", 
   RowBox[{"BSplineFunction", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"zint", "[", "s", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"s", ",", "0", ",", "1", ",", "0.01"}], "}"}]}], "]"}], ",", 
     RowBox[{"SplineDegree", "\[Rule]", "4"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.657532739823515*^9, 3.657532743770092*^9}, {
  3.657533352078638*^9, 3.657533424513402*^9}, {3.657533528780498*^9, 
  3.657533595790003*^9}, {3.657534103983925*^9, 
  3.657534105958561*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{"{", 
   RowBox[{"Red", ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Point", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"xint2", "[", "t", "]"}], ",", 
         RowBox[{"yint2", "[", "t", "]"}], ",", " ", 
         RowBox[{"zint2", "[", "t", "]"}]}], "}"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "1", ",", "0.1"}], "}"}]}], "]"}], ",", 
    RowBox[{"(*", 
     RowBox[{"Black", ",", 
      RowBox[{"Point", "/@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"xint", "[", "t", "]"}], ",", 
            RowBox[{"yint", "[", "t", "]"}], ",", " ", 
            RowBox[{"zint", "[", "t", "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "0", ",", "1", ",", "0.1"}], "}"}]}], "]"}]}], 
      ","}], "*)"}], "\[IndentingNewLine]", "Blue", ",", 
    RowBox[{"Point", "/@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Evaluate", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"xi", "[", "t", "]"}], ",", 
          RowBox[{"yi", "[", "t", "]"}], ",", " ", 
          RowBox[{"zi", "[", "t", "]"}]}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "1", ",", "0.1"}], "}"}]}], "]"}]}]}], 
   "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.715096378530127*^9, 3.715096521953668*^9}, {
  3.715096559143489*^9, 3.715096567620179*^9}, {3.715096709620078*^9, 
  3.715096800755268*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
From the parametrization, the moving local reference system can be obtained:\
\>", "Text",
 CellChangeTimes->{{3.715096927883286*^9, 
  3.715096957182778*^9}},ExpressionUUID->"9277104d-6b6b-4aa0-b890-\
452ca0981dc6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Kappa]", ",", "\[Tau]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"Ti", ",", "Ni", ",", "Bi"}], "}"}]}], "}"}], " ", "=", 
   RowBox[{"FrenetSerretSystem", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"xint2", "[", "t", "]"}], ",", 
       RowBox[{"yint2", "[", "t", "]"}], ",", 
       RowBox[{"zint2", "[", "t", "]"}]}], "}"}], ",", "t"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.657533627637414*^9, 
  3.657533631436824*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ptsCylinder", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"projectPointToMidline", "[", 
      RowBox[{"#", ",", "xint2", ",", "yint2", ",", "zint2", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Kappa]", ",", "\[Tau]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"Ti", ",", "Ni", ",", "Bi"}], "}"}]}], "}"}]}], "]"}], 
     "&"}], "/@", "pts2"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.657291360484021*^9, 3.6572913868855143`*^9}, {
  3.657291942495368*^9, 3.65729195739799*^9}, {3.6575419469868097`*^9, 
  3.6575419496444798`*^9}, {3.6610871437402153`*^9, 
  3.6610871449158382`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"minParameter", "=", 
   RowBox[{"Min", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Last", "[", "#", "]"}], "&"}], "/@", "ptsCylinder"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"maxParameter", "=", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Last", "[", "#", "]"}], "&"}], "/@", "ptsCylinder"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.65848387882095*^9, 3.658483940543996*^9}, {
  3.658484394123461*^9, 3.65848443784943*^9}, {3.661087182193818*^9, 
  3.661087209472797*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"smax", "=", 
  RowBox[{
   RowBox[{"s", "[", "1.0", "]"}], " ", "*", " ", 
   RowBox[{"(", 
    RowBox[{"maxParameter", "-", "minParameter"}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.661087261351487*^9, 3.661087275094413*^9}, {
  3.661087347253866*^9, 
  3.661087349771925*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
The local Frenet Serret coordinates allow us to project the position of cells \
onto a curved cylindrical reference frame.\
\>", "Text",
 CellChangeTimes->{{3.7150969811997766`*^9, 
  3.715097031033712*^9}},ExpressionUUID->"b4b53ffc-a502-4aa7-9484-\
6f2d417a04c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ptsCylinder", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "-", "minParameter"}], ")"}], "/", 
        
        RowBox[{"(", 
         RowBox[{"maxParameter", "-", "minParameter"}], ")"}]}]}], "}"}], 
     "&"}], "/@", "ptsCylinder"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.661087386022403*^9, 3.661087425813204*^9}, {
  3.6610874746178637`*^9, 3.661087476840064*^9}, {3.661087555102058*^9, 
  3.66108755659865*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"torsion", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"#", ",", 
       RowBox[{"(", 
        RowBox[{"\[Tau]", "/.", 
         RowBox[{"t", "\[Rule]", "#"}]}], ")"}]}], "}"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{"Last", "/@", "ptsCylinder"}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6584847108150263`*^9, 3.658484742010826*^9}, {
  3.6584847766653023`*^9, 3.6584847808957863`*^9}, {3.658484894640111*^9, 
  3.658484903524084*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["visualize the cell positions and the midline for reference", "Section",
 CellChangeTimes->{{3.714800094059774*^9, 
  3.714800129575683*^9}},ExpressionUUID->"231cc9ce-0a9b-4180-a02d-\
c3815f966ea0"],

Cell[BoxData[
 RowBox[{"Graphics3D", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"AbsolutePointSize", "[", "4", "]"}], ",", 
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Darker", "@", "Gray"}], ",", 
          RowBox[{"AbsolutePointSize", "[", "5", "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"transformToStandardView", "[", "#1", "]"}], "]"}], ",", 
          RowBox[{"AbsolutePointSize", "[", "4", "]"}], ",", 
          RowBox[{"brewerDiv", "[", 
           RowBox[{
            RowBox[{"ptsCylinder", "[", 
             RowBox[{"[", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"transformToStandardView", "[", "#1", "]"}], "]"}]}], 
         "}"}], "&"}], ",", "pts2"}], "]"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"xint", "[", "t", "]"}], ",", 
            RowBox[{"yint", "[", "t", "]"}], ",", 
            RowBox[{"zint", "[", "t", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", "1", ",", 
            RowBox[{"1", "/", "25"}]}], "}"}]}], "]"}], "]"}], ","}], "*)"}], 
     ",", 
     RowBox[{"AbsoluteThickness", "[", "5", "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"brewerDiv", "[", "ti", "]"}], ",", 
         RowBox[{"Line", "[", 
          RowBox[{"transformToStandardView", "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"xint2", "[", "ti", "]"}], ",", 
               RowBox[{"yint2", "[", "ti", "]"}], ",", 
               RowBox[{"zint2", "[", "ti", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"xint2", "[", 
                RowBox[{"ti", "+", "0.01"}], "]"}], ",", 
               RowBox[{"yint2", "[", 
                RowBox[{"ti", "+", "0.01"}], "]"}], ",", 
               RowBox[{"zint2", "[", 
                RowBox[{"ti", "+", "0.01"}], "]"}]}], "}"}]}], "}"}]}], 
          "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ti", ",", "minParameter", ",", 
         RowBox[{"maxParameter", "-", "0.01"}], ",", "0.01"}], "}"}]}], 
      "]"}]}], "}"}], ",", 
   RowBox[{"ViewPoint", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "Infinity"}], "}"}]}], ",", " ", 
   RowBox[{"Boxed", "\[Rule]", "False"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6748103843574123`*^9, 3.67481039236384*^9}, {
   3.674812365108189*^9, 3.6748123652260303`*^9}, {3.6748124194839363`*^9, 
   3.674812419683313*^9}, 
   3.71475704122814*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["estimate cell numbers in each chamber", "Section",
 CellChangeTimes->{{3.7147999385901213`*^9, 
  3.714799945736867*^9}},ExpressionUUID->"c9e53e8d-92cc-4d54-bc97-\
03bbd68e57e6"],

Cell["\<\
Usually, the border between atrium and ventricle can be estimated from the \
data by using the point of highest torsion along the midline. However, for \
some stages of development, this estimate might be unstable. We empirically \
found a value of 0.55 is optimal to be used for all datasets. For \
reproducibility we suggest to leave the parameter at this fixed value. \
\>", "Text",
 CellChangeTimes->{{3.714800483829522*^9, 
  3.714800689391974*^9}},ExpressionUUID->"51ab3851-c70d-4532-852e-\
91ef4ed741f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"maxTorsionPoint", "=", 
    RowBox[{
     RowBox[{"torsion", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"Abs", "[", "torsion", "]"}], ",", 
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", 
            RowBox[{"Last", "/@", "torsion"}], "]"}], "]"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"maxTorsionPoint", "=", "0.55"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.7148004331265783`*^9, 3.7148004494521723`*^9}, {
   3.7148006198487864`*^9, 3.714800626282967*^9}, 
   3.714800701290538*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
The parameter corresponding to the maximum torsion in the midline might not \
be a very accurate measure of the actual border between atrium and ventricle. \
Thus, we will compute expected number of A and V cells by averaging over a \
range of potential midpoint(s).\
\>", "Text",
 CellChangeTimes->{{3.714799959788142*^9, 3.714800038355215*^9}, {
  3.714800703127039*^9, 
  3.714800703805641*^9}},ExpressionUUID->"d0427b53-1ee8-4236-8b17-\
1f94f21bd08f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cellnums", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Length", "/@", 
      RowBox[{"SplitBy", "[", 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Last", "[", 
                RowBox[{"ptsCylinder", "[", 
                 RowBox[{"[", "#", "]"}], "]"}], "]"}], "\[LessEqual]", 
               RowBox[{"maxTorsionPoint", "+", "dt"}]}], ",", 
              RowBox[{"#", "\[Rule]", "\"\<A\>\""}], ",", 
              RowBox[{"#", "\[Rule]", "\"\<V\>\""}]}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "cells", "]"}], "]"}]}], ",", "Last"}], 
         "]"}], ",", "Last"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"dt", ",", 
       RowBox[{"-", "0.05"}], ",", "0.05", ",", "0.005"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.674900564965877*^9, 3.674900663146405*^9}, {
   3.6749007195481787`*^9, 3.67490072016461*^9}, 
   3.7148000537410393`*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"N", "@", 
      RowBox[{"Mean", "[", "#", "]"}]}], ",", 
     RowBox[{"N", "@", 
      RowBox[{"StandardDeviation", "[", "#", "]"}]}]}], "}"}], "&"}], "/@", 
  RowBox[{"Transpose", "[", "cellnums", "]"}]}]], "Input",
 CellChangeTimes->{{3.674900671211751*^9, 
  3.674900711058766*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
We will also need some rough idea of the chamber identity for each cell for \
later visualization purposes. \
\>", "Text",
 CellChangeTimes->{{3.714800304269573*^9, 
  3.714800385198593*^9}},ExpressionUUID->"e2a6cf89-9f54-42e1-8c52-\
1670d1180fc0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"avList", "=", 
   RowBox[{"SortBy", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Last", "[", 
           RowBox[{"ptsCylinder", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "]"}], "\[LessEqual]", 
          RowBox[{"maxTorsionPoint", "-", "0.04"}]}], ",", 
         RowBox[{"#", "\[Rule]", "\"\<A\>\""}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Last", "[", 
             RowBox[{"ptsCylinder", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "\[GreaterEqual]", " ", 
            RowBox[{"maxTorsionPoint", "+", "0.04"}]}], ",", 
           RowBox[{"#", "\[Rule]", "\"\<V\>\""}], ",", 
           RowBox[{"#", "\[Rule]", "\"\<AV\>\""}]}], "]"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "cells", "]"}], "]"}]}], ",", "Last"}], "]"}]}],
   ";"}]], "Input",
 CellChangeTimes->{{3.667722098084601*^9, 3.6677222070604486`*^9}, {
   3.674472441692232*^9, 3.674472488793448*^9}, {3.674472521835477*^9, 
   3.674472524939488*^9}, {3.674472623544351*^9, 3.6744726269678917`*^9}, {
   3.674527172701045*^9, 3.674527211130355*^9}, 
   3.714800719313485*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"atrialCells", ",", "avCells", ",", "ventricularCells"}], "}"}], 
   "=", 
   RowBox[{"Map", "[", 
    RowBox[{"First", ",", 
     RowBox[{"SplitBy", "[", 
      RowBox[{"avList", ",", "Last"}], "]"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.667722220336244*^9, 3.667722254306622*^9}, {
   3.6744725384157963`*^9, 3.674472540359473*^9}, 
   3.714800721377784*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["timing of activation onset", "Section",
 CellChangeTimes->{{3.7148001354194107`*^9, 
  3.714800145776949*^9}},ExpressionUUID->"454e4d3d-af3d-4d70-917e-\
a1baf41dc744"],

Cell[BoxData[
 RowBox[{"activationMap", "=", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", " ", "onsetAP", ",", " ", 
    RowBox[{"Min", "[", "onsetAP", "]"}], ",", 
    RowBox[{"Quantile", "[", 
     RowBox[{"onsetAP", ",", "0.99"}], "]"}], ",", "\"\<BrightBands\>\"", ",",
     "0.2", ",", "0.", ",", "False", ",", "3.5", ",", "False"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6745282979505587`*^9, 3.674528301061512*^9}, {
  3.674821925042594*^9, 3.674821941144149*^9}, {3.6748289398907557`*^9, 
  3.6748289460884123`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["rise time of Ca signal", "Section",
 CellChangeTimes->{{3.714800175619068*^9, 
  3.714800180254163*^9}},ExpressionUUID->"de24c3c8-bfd3-4ba8-9dee-\
d42cf949e219"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"Transpose", "[", 
   RowBox[{"{", 
    RowBox[{"onsetAP", ",", "riseTime"}], "}"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.662021522868051*^9, 3.662021523766562*^9}, {
   3.667719823805811*^9, 3.667719849316434*^9}, 
   3.714757419683115*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{"riseTime", ",", 
   RowBox[{"PlotTheme", "\[Rule]", "\"\<Monochrome\>\""}], ",", 
   RowBox[{"Axes", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"False", ",", "True"}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.661700846450927*^9, 3.661700851761403*^9}, {
  3.661703505595764*^9, 3.661703507666144*^9}, {3.661703565462967*^9, 
  3.6617037275766172`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.6617013057122993`*^9, 
  3.661701329614709*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"riseTimeMap", "=", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", "riseTime", ",", 
    RowBox[{"Quantile", "[", 
     RowBox[{"riseTime", ",", "0.05"}], "]"}], ",", 
    RowBox[{"Quantile", "[", 
     RowBox[{"riseTime", ",", "0.95"}], "]"}], ",", "brewerDiv", ",", "0.6", 
    ",", "0.", ",", "False", ",", "3.5", ",", "False"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.661701073813253*^9, 3.661701085570752*^9}, {
  3.661705040721066*^9, 
  3.6617050416867657`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["pacemaker cells", "Section",
 CellChangeTimes->{{3.714800193463006*^9, 
  3.714800203089444*^9}},ExpressionUUID->"4c2815ae-957d-4ecd-ace5-\
a55c0f6b3665"],

Cell["\<\
Pacemaker cells are the earliest cells to be active in the cardiac cycle and \
are known to conduct slowly. Thus we filter the data for corresponding \
candidate cells that fulfill both criteria.\
\>", "Text",
 CellChangeTimes->{{3.715097073743037*^9, 
  3.7150971706306953`*^9}},ExpressionUUID->"9d9ce2b1-1d34-47f4-b5cc-\
5d3ad0b26873"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dspeeds", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
      RowBox[{"i", ",", "2", ",", "0"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.658583843468987*^9, 3.6585838435945272`*^9}, {
  3.658584043762561*^9, 3.658584045348884*^9}, {3.6585844445660267`*^9, 
  3.6585844758161173`*^9}, {3.658584527833364*^9, 3.658584527983161*^9}, {
  3.658585119971941*^9, 3.658585120086228*^9}, {3.658642864229087*^9, 
  3.658642864340123*^9}, {3.658643936209962*^9, 3.65864393631931*^9}, {
  3.674459246871963*^9, 
  3.6744592479825687`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dspeeds", "=", 
   RowBox[{"dspeeds", "/.", 
    RowBox[{"Indeterminate", "\[Rule]", "0"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.658583943391049*^9, 
  3.658583958486988*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"speedThresh", "=", 
  RowBox[{"N", "[", 
   RowBox[{"Quantile", "[", 
    RowBox[{"dspeeds", ",", "0.25"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.658584912132246*^9, 3.658584935579317*^9}, {
   3.658640848223405*^9, 3.658640850572978*^9}, 3.658644604502441*^9, {
   3.658644832048003*^9, 3.658644832157529*^9}, {3.6586451526375923`*^9, 
   3.658645153052355*^9}, 3.658645217677004*^9, 3.6586452953128*^9, 
   3.658645410439806*^9, {3.658645965719816*^9, 3.6586459931269417`*^9}, {
   3.658646036131361*^9, 3.658646036259658*^9}, 3.6586464494387293`*^9, {
   3.659075746778187*^9, 3.659075770767416*^9}, {3.6616983730297813`*^9, 
   3.661698373133033*^9}, {3.674378109360026*^9, 
   3.674378110343691*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"onsetThresh", "=", 
  RowBox[{"N", "[", 
   RowBox[{"Quantile", "[", 
    RowBox[{"tAct", ",", "0.05"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.65858494051272*^9, 3.6585849495063267`*^9}, {
   3.6586408533013*^9, 3.658640856116851*^9}, {3.658644663284881*^9, 
   3.658644663386512*^9}, {3.658644858165452*^9, 3.658644858740932*^9}, 
   3.658645188340838*^9, {3.6586452203871593`*^9, 3.65864522050681*^9}, {
   3.658645301352927*^9, 3.658645301464444*^9}, {3.658645969485896*^9, 
   3.658645997044705*^9}, {3.658646030060698*^9, 3.658646030899784*^9}, {
   3.6586460688435783`*^9, 3.658646068938663*^9}, {3.6586461703862677`*^9, 
   3.658646170511773*^9}, 3.658647033910527*^9, {3.661147784805784*^9, 
   3.6611477858989697`*^9}, {3.6611479671762037`*^9, 
   3.6611479686491337`*^9}, {3.6616990082715483`*^9, 3.6616990087371273`*^9}, 
   3.6616991468407927`*^9, {3.6616994191289988`*^9, 
   3.661699419822522*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"candidateConduction", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Position", "[", 
    RowBox[{"dspeeds", ",", 
     RowBox[{"x_", "/;", 
      RowBox[{"x", "\[LessEqual]", "speedThresh"}]}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.658584955736683*^9, 3.658585005313402*^9}, {
  3.658640861765098*^9, 
  3.658640863481593*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"candidateActivation", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Position", "[", 
    RowBox[{"tAct", ",", 
     RowBox[{"x_", "/;", 
      RowBox[{"x", "\[LessEqual]", " ", "onsetThresh"}]}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.658644452225992*^9, 3.658644473196847*^9}, {
  3.66114797959834*^9, 
  3.661147980385624*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"pacemakers", "=", 
  RowBox[{"Intersection", "[", 
   RowBox[{"candidateConduction", ",", "candidateActivation"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.658585033562489*^9, 3.658585063271921*^9}, {
  3.6586436870308733`*^9, 3.658643688852396*^9}, {3.65864448138505*^9, 
  3.6586444952206497`*^9}, {3.658645259362289*^9, 3.6586452596018953`*^9}, {
  3.65864709325142*^9, 3.658647102736906*^9}, {3.674378094679895*^9, 
  3.674378094872119*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"pacemakers", "=", 
  RowBox[{"Sort", "[", 
   RowBox[{"pacemakers", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"onsetAP", "[", 
       RowBox[{"[", "#1", "]"}], "]"}], "\[LessEqual]", 
      RowBox[{"onsetAP", "[", 
       RowBox[{"[", "#2", "]"}], "]"}]}], "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.674378153447526*^9, 3.6743781545610323`*^9}, {
  3.674378190454486*^9, 
  3.674378237755431*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"pacemakerReference", "=", 
  RowBox[{"Graphics3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Point", "[", 
         RowBox[{"transformToStandardView", "[", "#", "]"}], "]"}], "&"}], "/@",
        "pts2"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"brewerQ1", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{"AbsolutePointSize", "[", "12", "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"transformToStandardView", "[", 
            RowBox[{"pts2", "[", 
             RowBox[{"[", 
              RowBox[{"pacemakers", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}], 
          ",", "\[IndentingNewLine]", "Black", ",", 
          RowBox[{"AbsolutePointSize", "[", "5", "]"}], ",", 
          RowBox[{"Point", "[", 
           RowBox[{"transformToStandardView", "[", 
            RowBox[{"pts2", "[", 
             RowBox[{"[", 
              RowBox[{"pacemakers", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}]}], 
         "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "pacemakers", "]"}]}], "}"}]}], "]"}]}], 
     "}"}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "Infinity"}], "}"}]}], ",", 
    RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "400"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.661753264481839*^9, 3.661753395970436*^9}, {
  3.661950845803421*^9, 3.661950859305317*^9}, {3.662225926630834*^9, 
  3.662225935788292*^9}, {3.662226097630781*^9, 3.662226097774438*^9}, {
  3.66222613946973*^9, 3.66222622729802*^9}, {3.662226266176409*^9, 
  3.6622262662804193`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"lambda", ",", "evecs"}], "}"}], "=", 
   RowBox[{"Eigensystem", "[", 
    RowBox[{"Covariance", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"pts2", "[", 
        RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "pacemakers"}], "]"}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.674378489887767*^9, 3.674378533808881*^9}, {
   3.674378697229293*^9, 3.674378698291449*^9}, 
   3.715008246224944*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"planarPos", "=", 
   RowBox[{"Most", "/@", 
    RowBox[{"PrincipalComponents", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"pts2", "[", 
        RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "pacemakers"}], 
     "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6743785448861713`*^9, 3.674378599758741*^9}, {
   3.674378705682624*^9, 3.674378706307111*^9}, 
   3.715008243626906*^9},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"planarView", "=", 
  RowBox[{"Graphics", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"brewerQ1", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"AbsolutePointSize", "[", "12", "]"}], ",", 
       RowBox[{"Point", "[", 
        RowBox[{"planarPos", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "Black", ",", 
       RowBox[{"AbsolutePointSize", "[", "5", "]"}], ",", 
       RowBox[{"Point", "[", 
        RowBox[{"planarPos", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "pacemakers", "]"}]}], "}"}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.674378603677668*^9, 3.6743786369207706`*^9}, {
  3.674378684525652*^9, 3.674378688147921*^9}, {3.6743787283642483`*^9, 
  3.674378753961753*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["metric vs. discrete conduction speed", "Section",
 CellChangeTimes->{{3.655480094265173*^9, 3.65548010495217*^9}, {
  3.661152004948547*^9, 3.661152012806535*^9}, {3.7147983349410973`*^9, 
  3.714798340237597*^9}},ExpressionUUID->"7d6642a1-b93d-4071-aabe-\
0b1694497ced"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dspeeds", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
      RowBox[{"i", ",", "2", ",", "0"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"metricSpeeds", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
      RowBox[{"i", ",", "2", ",", "0"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.655480115569909*^9, 3.6554801574515*^9}, 
   3.655488175389244*^9, 3.655489634025832*^9, {3.657960163935708*^9, 
   3.65796019785093*^9}, {3.65864175522805*^9, 3.658641755339617*^9}, {
   3.658641790557269*^9, 3.65864179117835*^9}, {3.658641853171405*^9, 
   3.658641880903821*^9}, {3.6611482579014063`*^9, 3.6611482618037863`*^9}, {
   3.661148350843198*^9, 3.661148351008327*^9}, {3.661148924616702*^9, 
   3.6611489485986643`*^9}, {3.667720779025653*^9, 3.6677208154002867`*^9}, 
   3.6677209967101173`*^9, {3.6744602340423326`*^9, 3.6744602505295267`*^9}, {
   3.714757521136116*^9, 
   3.714757522438507*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"metricSpeedMap", " ", "=", " ", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
       RowBox[{"i", ",", "2", ",", "0"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}], ",", "0", 
    ",", "maxMetricSpeed", ",", "brewerDiv", ",", "0.6", ",", "0.8", ",", 
    "False", ",", "3.5"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.674372267914668*^9, 3.674372282370551*^9}, {
  3.674372333874322*^9, 3.674372348063808*^9}, {3.6743725752642517`*^9, 
  3.6743725758159122`*^9}, {3.6744602939189463`*^9, 
  3.674460301596486*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"feat", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
      RowBox[{"#", ",", "2", ",", "0", ",", "tAct"}], "]"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "cells", "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"MapIndexed", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"AbsolutePointSize", "[", "8", "]"}], ",", 
        RowBox[{"brewerDiv", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"feat", "[", 
            RowBox[{"[", 
             RowBox[{"#2", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ")"}], "/", 
          RowBox[{"(", "4", ")"}]}], "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "10"}], 
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], ",", 
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], "&"}], 
     ",", "ptsCylinder"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7111774910759783`*^9, 3.711177517676385*^9}, {
  3.71117756247841*^9, 3.71117756274317*^9}, {3.7111778659992323`*^9, 
  3.711177890669196*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"averageDelayMap", " ", "=", " ", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
       RowBox[{"i", ",", "2", ",", "0"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}], ",", 
    "minDelay", ",", ".18", ",", "brewerDiv", ",", "0.6", ",", "0.8", ",", 
    "False", ",", "3.5"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6743713559643593`*^9, 3.6743713923610897`*^9}, {
  3.674371630114952*^9, 3.674371662039706*^9}, {3.674549397601242*^9, 
  3.6745494356706867`*^9}, {3.676188853128833*^9, 3.676188870253785*^9}, {
  3.714755282054624*^9, 
  3.71475528441774*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"feat", "=", "dspeeds"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"MapIndexed", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"AbsolutePointSize", "[", "8", "]"}], ",", 
        RowBox[{"brewerDiv", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"feat", "[", 
             RowBox[{"[", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", "0"}], 
           ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"maxDelay", "-", "0"}], ")"}]}], "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "10"}], 
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], ",", 
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], "&"}], 
     ",", "ptsCylinder"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.657302433814725*^9, 3.657302434821333*^9}, {
  3.661153686263054*^9, 3.661153686461342*^9}, {3.661153765964826*^9, 
  3.661153766677331*^9}, {3.661153807899708*^9, 3.661153808875239*^9}, {
  3.661155807901713*^9, 3.661155808955677*^9}, {3.661155983558734*^9, 
  3.6611559907184763`*^9}, {3.66115624979014*^9, 3.661156250963889*^9}, {
  3.67437920607487*^9, 
  3.674379216235499*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"speedScatter", "=", 
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
           RowBox[{"#", ",", "2", ",", "0"}], "]"}], ",", 
          RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
           RowBox[{"#", ",", "2", ",", "0"}], "]"}]}], "}"}], "&"}], "/@", 
       "atrialCells"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
           RowBox[{"#", ",", "2", ",", "0"}], "]"}], ",", 
          RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
           RowBox[{"#", ",", "2", ",", "0"}], "]"}]}], "}"}], "&"}], "/@", 
       "ventricularCells"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
           RowBox[{"#", ",", "2", ",", "0"}], "]"}], ",", 
          RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
           RowBox[{"#", ",", "2", ",", "0"}], "]"}]}], "}"}], "&"}], "/@", 
       "avCells"}]}], "}"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"atrialColor", ",", "ventricularColor", ",", "Gray"}], 
      "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.674382740663094*^9, 3.6743828018163853`*^9}, 
   3.6744604461387587`*^9, {3.674460553471793*^9, 3.674460564422983*^9}, {
   3.674472687657523*^9, 3.674472726977704*^9}, {3.676189068380701*^9, 
   3.676189074467762*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["estimate local cell density and shape", "Section",
 CellChangeTimes->{{3.655542186325748*^9, 3.655542196060515*^9}, {
  3.714757658868689*^9, 3.714757663204279*^9}, {3.7148009653506413`*^9, 
  3.714800969278163*^9}},ExpressionUUID->"10576cdc-3729-457c-bc69-\
be5b0bbcaadb"],

Cell[BoxData[
 RowBox[{"cellshapePlot", "=", 
  RowBox[{"Graphics3D", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Opacity", "[", "1", "]"}], ",", 
        RowBox[{
         RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "cells", "]"}], "]"}]}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "Infinity"}], "}"}]}], ",", 
    RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.669033831788615*^9, 3.669033876723979*^9}, {
   3.669033913378529*^9, 3.6690339134990273`*^9}, {3.669033983626368*^9, 
   3.669034007847899*^9}, {3.6690946528101473`*^9, 3.669094689308839*^9}, {
   3.669094810578903*^9, 3.6690948124889927`*^9}, {3.6690948648751698`*^9, 
   3.669094902454472*^9}, {3.669435934202354*^9, 3.669435990752426*^9}, 
   3.66943607180571*^9, {3.6694361236293497`*^9, 3.6694361423156567`*^9}, {
   3.669436172940507*^9, 3.6694361731141233`*^9}, {3.669436712352439*^9, 
   3.669436718816019*^9}, {3.6762117803571787`*^9, 3.676211784436061*^9}, {
   3.71480115240938*^9, 
   3.7148011578476562`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"cellshapePlotActTime", "=", 
  RowBox[{"Graphics3D", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ColorData", "[", 
         RowBox[{"\"\<BrightBands\>\"", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"onsetAP", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "-", 
             RowBox[{"Min", "[", "onsetAP", "]"}]}], ")"}], "/", 
           RowBox[{"(", "123", ")"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "cells", "]"}], "]"}]}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "Infinity"}], "}"}]}], ",", 
    RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "800"}], ",", 
    RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.674836806673832*^9, 3.6748368439379597`*^9}, {
  3.6748369578241367`*^9, 3.6748369587924747`*^9}, {3.674837048626075*^9, 
  3.674837073223299*^9}, {3.7148011844491777`*^9, 3.714801187930511*^9}, {
  3.7148012678482533`*^9, 3.7148012719234447`*^9}, {3.714801309287915*^9, 
  3.714801313089266*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"volumes", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
      RowBox[{"[", "4", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "cells", "]"}], "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.669035792180029*^9, 
  3.669035813329322*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{
  RowBox[{"areas", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
      RowBox[{"[", "5", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "cells", "]"}], "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.669035792180029*^9, 3.669035813329322*^9}, {
  3.6690359577475233`*^9, 
  3.669035962586417*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
To visualize and individual dataset the robust quantiles should be used to \
adjust the color scale instead of actual min and max of the data.\
\>", "Text",
 CellChangeTimes->{{3.71480149878187*^9, 
  3.714801567151441*^9}},ExpressionUUID->"5e37702b-591b-43ca-9599-\
f5b9f84cc33b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"min", ",", "max", ",", "span"}], "}"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Min", "[", "areas", "]"}], ",", " ", 
    RowBox[{"Quantile", "[", 
     RowBox[{"areas", ",", "0.95"}], "]"}], ",", 
    RowBox[{
     RowBox[{"Quantile", "[", 
      RowBox[{"areas", ",", "0.95"}], "]"}], "-", 
     RowBox[{"Min", "[", "areas", "]"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.669035815349022*^9, 3.669035826622922*^9}, {
  3.66903596744239*^9, 3.669035992953884*^9}, {3.669358702008354*^9, 
  3.669358716207323*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell["\<\
However, to facilitate visual comparison across datasets, the robust \
statistics should be taken across all samples. Here are the values for \
reproducibility:\
\>", "Text",
 CellChangeTimes->{{3.714801570951537*^9, 
  3.714801610854075*^9}},ExpressionUUID->"84ab2c06-c4a8-4500-a484-\
2ce1905f6e72"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"min", ",", "max", ",", "span"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "4325.125782909306`", ",", "279616.4530206217`", ",", 
     "275291.3272377124`"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.669358679608533*^9, 3.669358691568215*^9}, {
  3.6693587250661087`*^9, 
  3.669358726414674*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"cellShapePlotSizes", "=", 
  RowBox[{"Graphics3D", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"EdgeForm", "[", 
         RowBox[{"Directive", "[", 
          RowBox[{"Thick", ",", "Black"}], "]"}], "]"}], ",", 
        RowBox[{"Specularity", "[", "0", "]"}], ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
            RowBox[{"[", "6", "]"}], "]"}], "\[LessEqual]", "5"}], ",", 
          RowBox[{"Opacity", "[", "0.05", "]"}], ",", 
          RowBox[{"Opacity", "[", "1", "]"}]}], "]"}], ",", 
        RowBox[{"brewerDiv", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
             RowBox[{"[", "5", "]"}], "]"}], "-", 
            RowBox[{"(", "min", ")"}]}], ")"}], "/", 
          RowBox[{"(", "span", ")"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"estimateCellShape", "[", "#", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "cells", "]"}], "]"}]}], ",", 
    RowBox[{"Lighting", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"\"\<Ambient\>\"", ",", "White"}], "}"}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "Infinity"}], "}"}]}], ",", 
    RowBox[{"Boxed", "\[Rule]", "False"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.6690357714979467`*^9, {3.669035839407207*^9, 3.669035862327612*^9}, {
   3.669035998353916*^9, 3.669036004913271*^9}, {3.669036045304666*^9, 
   3.669036074007044*^9}, {3.669095026180835*^9, 3.669095045434342*^9}, {
   3.669095106946199*^9, 3.669095126303825*^9}, {3.6690952280406523`*^9, 
   3.66909527269092*^9}, {3.6694366775013247`*^9, 3.669436697864643*^9}, {
   3.714801444479867*^9, 
   3.71480146459443*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["plot Calcium transients", "Section",
 CellChangeTimes->{{3.714801477250408*^9, 
  3.714801482883754*^9}},ExpressionUUID->"f8898f93-94e0-4b68-8dff-\
6d4be40264ec"],

Cell[BoxData[
 RowBox[{"waveFormsShapePlotColSlope", "=", 
  RowBox[{"ListLinePlot", "[", 
   RowBox[{"shifted", ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Directive", "[", 
        RowBox[{
         RowBox[{"Opacity", "[", "0.15", "]"}], ",", 
         RowBox[{"brewerDiv", "[", 
          RowBox[{
           RowBox[{"Rescale", "[", "riseTime", "]"}], "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "res", "]"}]}], "}"}]}], "]"}]}], ",", 
    RowBox[{"LabelStyle", "\[Rule]", "Medium"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.655480622929921*^9, 3.655480638876792*^9}, {
   3.656411509884894*^9, 3.656411511748838*^9}, 3.656411663046611*^9, 
   3.658588900316298*^9, 3.674461209530829*^9, {3.6748261261946383`*^9, 
   3.6748261468484507`*^9}, {3.6748265018296223`*^9, 3.674826502783216*^9}, {
   3.7148016418660583`*^9, 
   3.714801643184353*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"],

Cell[BoxData[
 RowBox[{"waveFormsShapePlotColOnset", "=", 
  RowBox[{"ListLinePlot", "[", 
   RowBox[{"res", ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Directive", "[", 
        RowBox[{
         RowBox[{"Opacity", "[", "0.15", "]"}], ",", 
         RowBox[{"ColorData", "[", 
          RowBox[{"\"\<BrightBands\>\"", ",", 
           RowBox[{
            RowBox[{"Rescale", "[", "onsetAP", "]"}], "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "res", "]"}]}], "}"}]}], "]"}]}], ",", 
    RowBox[{"LabelStyle", "\[Rule]", "Medium"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.656411698972363*^9, 3.656411706333572*^9}, 
   3.6585889051005*^9, {3.674461229286212*^9, 3.674461246189671*^9}, {
   3.674472762346902*^9, 3.6744727626837597`*^9}, {3.674825705442499*^9, 
   3.674825708224155*^9}, {3.674837581087907*^9, 3.6748376143262177`*^9}, {
   3.7148016529046497`*^9, 
   3.7148016530832167`*^9}},ExpressionUUID->"00000000-0000-0000-0000-\
000000000000"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Simulation of isotropic nearest neighbor signal propagation (SIR model)\
\>", "Section",
 CellChangeTimes->{{3.7148007477166452`*^9, 
  3.7148007687438803`*^9}},ExpressionUUID->"4318db04-63a2-424b-91f7-\
6d8169d4272a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "getNeighbors", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getNeighbors", "[", 
   RowBox[{"cell_", ",", "gdistMat_"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Position", "[", 
    RowBox[{
     RowBox[{"gdistMat", "[", 
      RowBox[{"[", "cell", "]"}], "]"}], ",", 
     RowBox[{"x_", "/;", 
      RowBox[{"0", "<", "x", "\[LessEqual]", "1"}]}]}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "simulationStep", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"simulationStep", "[", 
   RowBox[{"active_", ",", "susceptible_", ",", "recovering_"}], "]"}], ":=", 
  
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"newactive", ",", "newsusceptible", ",", "newrecovering"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newactive", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"getNeighbors", "[", 
             RowBox[{"#", ",", "gdistMat"}], "]"}], "&"}], "/@", "active"}], 
          "]"}], "]"}], ",", 
        RowBox[{"Union", "[", 
         RowBox[{"active", ",", "recovering"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newrecovering", " ", "=", " ", 
      RowBox[{"Union", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"recovering", ",", " ", "active"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newsusceptible", " ", "=", " ", 
      RowBox[{"Complement", "[", 
       RowBox[{"susceptible", ",", "newactive"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "newactive", ",", " ", "newsusceptible", ",", " ", "newrecovering"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.674916747975945*^9, 3.674916766437647*^9}, {
  3.674917770527608*^9, 3.674917783389551*^9}, {3.674917957756702*^9, 
  3.674917957964135*^9}},ExpressionUUID->"2c3d0404-be6f-4e7f-ac04-\
b7028b0af029"],

Cell[BoxData[
 RowBox[{"source", "=", "pacemakers"}]], "Input",
 CellChangeTimes->{{3.674916579614853*^9, 3.6749165808521347`*^9}, {
  3.714800790136064*^9, 
  3.714800792005128*^9}},ExpressionUUID->"0423ba70-4966-4d1b-9858-\
6d5e8adb273d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"susceptible", "=", 
   RowBox[{"Complement", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "cells", "]"}], "]"}], ",", "source"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"active", " ", "=", " ", "source"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"recovering", "=", 
   RowBox[{"{", "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.674916612418435*^9, 3.674916638492936*^9}, {
  3.6749179373520403`*^9, 
  3.6749179488360777`*^9}},ExpressionUUID->"bde13386-bb42-4a65-901b-\
14882ccf4cf9"],

Cell[BoxData[
 RowBox[{"simulation", "=", 
  RowBox[{"First", "/@", 
   RowBox[{"NestList", " ", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"simulationStep", "[", 
       RowBox[{"Sequence", "@@", "#"}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"active", ",", "susceptible", ",", "recovering"}], "}"}], ",", 
     "15"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.674917007132062*^9, 3.67491718544058*^9}, {
  3.674917247703224*^9, 3.674917257020958*^9}, {3.674917291019924*^9, 
  3.674917292450938*^9}, {3.674917838053604*^9, 
  3.674917838204379*^9}},ExpressionUUID->"d0667e10-978b-4355-9d54-\
cb6ed3815c21"],

Cell[BoxData[
 RowBox[{
  RowBox[{"onsetSim", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"simulation", ",", "i"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.674917284612426*^9, 
  3.674917325999716*^9}},ExpressionUUID->"265eb7ec-725f-4f8a-81fa-\
3d42fa1eeeb4"],

Cell["\<\
We can look at the synthetic activation front. They look different than the \
measured patterns:\
\>", "Text",
 CellChangeTimes->{{3.714800822633004*^9, 
  3.7148008642570543`*^9}},ExpressionUUID->"2c226370-5a12-4fe0-ac92-\
611f04569af6"],

Cell[BoxData[
 RowBox[{"activationMapSim", "=", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", " ", "onsetSim", ",", " ", 
    RowBox[{"Min", "[", "onsetSim", "]"}], ",", 
    RowBox[{"Max", "[", "onsetSim", "]"}], ",", "\"\<BrightBands\>\"", ",", 
    "0.2", ",", "0.", ",", "False", ",", "3.5", ",", "False"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.674917344518055*^9, 
  3.6749173596741056`*^9}},ExpressionUUID->"db551980-24e7-4ce2-aee0-\
a1f9a81d5bca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"feat", "=", "onsetSim"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Quantile", "[", 
  RowBox[{"feat", ",", "0.95"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"MapIndexed", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"AbsolutePointSize", "[", "8", "]"}], ",", 
        RowBox[{"ColorData", "[", 
         RowBox[{"\"\<BrightBands\>\"", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"feat", "[", 
              RowBox[{"[", 
               RowBox[{"#2", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
             RowBox[{"Min", "[", "feat", "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Max", "[", "feat", "]"}], "-", 
             RowBox[{"Min", "[", "feat", "]"}]}], ")"}]}]}], "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "10"}], 
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], ",", 
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], "&"}], 
     ",", "ptsCylinder"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.674917393779827*^9, 
  3.674917420798092*^9}},ExpressionUUID->"538bb84a-01c5-4e67-bcf6-\
4bae4f8f5106"],

Cell["\<\
The discrete conduction speed show no pattern and the metric speeds are \
simply biased due to the longer distances in the atrium (as expected).\
\>", "Text",
 CellChangeTimes->{{3.71480086955997*^9, 
  3.714800948817512*^9}},ExpressionUUID->"2fe93a8b-6297-488e-96b8-\
8412a28d34a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dspeedsSim", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"estimateDiscreteWaveSpeedAtCell", "[", 
      RowBox[{"i", ",", "2", ",", "0", ",", "onsetSim"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.67491752037591*^9, 3.6749175319782963`*^9}, {
  3.6749181845114202`*^9, 
  3.674918195861676*^9}},ExpressionUUID->"cb8b4dcc-695b-47dd-8cd8-\
565e4cb39a9f"],

Cell[BoxData[
 RowBox[{"averageDelayMapSim", " ", "=", " ", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", "dspeedsSim", ",", 
    RowBox[{"Min", "[", "dspeedsSim", "]"}], ",", 
    RowBox[{"Quantile", "[", 
     RowBox[{"dspeedsSim", ",", "0.99"}], "]"}], ",", "brewerDiv", ",", "0.6",
     ",", "0.8", ",", "False", ",", "3.5"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6749175628752832`*^9, 3.674917639139024*^9}, {
  3.674918162433338*^9, 
  3.674918172095543*^9}},ExpressionUUID->"09687e2f-52b6-4b78-9bfa-\
5dc9cd2347ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mspeedsSim", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"estimateMetricWaveSpeedAtCell", "[", 
      RowBox[{"i", ",", "2", ",", "0", ",", "onsetSim"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "cells", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.67491752037591*^9, 3.6749175319782963`*^9}, {
  3.674917989216436*^9, 
  3.67491800389215*^9}},ExpressionUUID->"de8dfb28-4c78-4a15-ae9f-\
6c7313e388b5"],

Cell[BoxData[
 RowBox[{"averageMetricMapSim", " ", "=", " ", 
  RowBox[{"viewHeart", "[", 
   RowBox[{"cells", ",", "mspeedsSim", ",", 
    RowBox[{"Min", "[", "mspeedsSim", "]"}], ",", 
    RowBox[{"Quantile", "[", 
     RowBox[{"mspeedsSim", ",", "0.99"}], "]"}], ",", "brewerDiv", ",", "0.6",
     ",", "0.8", ",", "False", ",", "3.5"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6749175628752832`*^9, 3.674917639139024*^9}, {
  3.67491799258185*^9, 3.6749180542156763`*^9}, {3.674918339634589*^9, 
  3.674918354491171*^9}},ExpressionUUID->"ec42587c-bb21-4f0e-82e4-\
538741a1637a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"feat", "=", "dspeedsSim"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Quantile", "[", 
  RowBox[{"feat", ",", "0.95"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"MapIndexed", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"AbsolutePointSize", "[", "8", "]"}], ",", 
        RowBox[{"brewerDiv", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"feat", "[", 
             RowBox[{"[", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
            RowBox[{"Min", "[", "feat", "]"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Quantile", "[", 
             RowBox[{"feat", ",", "0.99"}], "]"}], "-", 
            RowBox[{"Min", "[", "feat", "]"}]}], ")"}]}], "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "10"}], 
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], ",", 
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], "&"}], 
     ",", "ptsCylinder"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.67491809749795*^9, 
  3.674918143037573*^9}},ExpressionUUID->"d772bca8-05ad-4c98-85ef-\
bba8692a4248"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"feat", "=", "mspeedsSim"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Quantile", "[", 
  RowBox[{"feat", ",", "0.95"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Graphics", "[", 
  RowBox[{
   RowBox[{"MapIndexed", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"AbsolutePointSize", "[", "8", "]"}], ",", 
        RowBox[{"brewerDiv", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"feat", "[", 
             RowBox[{"[", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
            RowBox[{"Min", "[", "feat", "]"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Max", "[", "feat", "]"}], "-", 
            RowBox[{"Min", "[", "feat", "]"}]}], ")"}]}], "]"}], ",", 
        RowBox[{"Point", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "10"}], 
            RowBox[{"#1", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], ",", 
           RowBox[{"#1", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], "&"}], 
     ",", "ptsCylinder"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.674917393779827*^9, 3.674917420798092*^9}, {
  3.674918074294484*^9, 
  3.674918090778043*^9}},ExpressionUUID->"2f32c3c2-d39e-444d-92d5-\
85c36ad37290"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1573, 1084},
WindowMargins->{{156, Automatic}, {Automatic, 3}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
FrontEndVersion->"11.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (April 27, \
2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 264, 6, 92, "Title"],
Cell[847, 30, 377, 8, 30, "Text"],
Cell[1227, 40, 315, 8, 32, "Input"],
Cell[1545, 50, 337, 9, 32, "Input"],
Cell[CellGroupData[{
Cell[1907, 63, 175, 3, 63, "Subchapter"],
Cell[2085, 68, 420, 8, 30, "Text"],
Cell[2508, 78, 673, 13, 54, "Input"],
Cell[3184, 93, 248, 6, 30, "Text"],
Cell[3435, 101, 3049, 46, 54, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6521, 152, 279, 4, 63, "Subchapter"],
Cell[CellGroupData[{
Cell[6825, 160, 172, 3, 64, "Section"],
Cell[7000, 165, 6807, 108, 117, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13844, 278, 175, 3, 64, "Section"],
Cell[14022, 283, 1717, 43, 180, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15776, 331, 165, 3, 64, "Section"],
Cell[15944, 336, 7399, 118, 264, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[23392, 460, 232, 4, 63, "Subchapter"],
Cell[CellGroupData[{
Cell[23649, 468, 237, 4, 64, "Section"],
Cell[23889, 474, 4167, 119, 306, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28093, 598, 174, 3, 64, "Section"],
Cell[28270, 603, 393, 8, 30, "Text"],
Cell[28666, 613, 1911, 52, 159, "Input"],
Cell[30580, 667, 1411, 40, 117, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[32028, 712, 195, 3, 64, "Section"],
Cell[32226, 717, 308, 7, 30, "Text"],
Cell[32537, 726, 1922, 55, 117, "Input"],
Cell[34462, 783, 317, 7, 30, "Text"],
Cell[34782, 792, 1757, 53, 54, "Input"],
Cell[36542, 847, 210, 5, 32, "Input"],
Cell[36755, 854, 252, 6, 30, "Text"],
Cell[37010, 862, 360, 9, 54, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[37407, 876, 193, 3, 64, "Section"],
Cell[37603, 881, 713, 21, 32, "Input"],
Cell[38319, 904, 195, 3, 30, "Text"],
Cell[38517, 909, 336, 7, 32, "Input"],
Cell[38856, 918, 545, 10, 49, "Text"],
Cell[39404, 930, 952, 20, 32, "Input"],
Cell[40359, 952, 282, 4, 30, "Text"],
Cell[40644, 958, 1023, 29, 54, "Input"],
Cell[41670, 989, 440, 11, 54, "Input"],
Cell[42113, 1002, 350, 7, 30, "Text"],
Cell[42466, 1011, 675, 17, 32, "Input"],
Cell[43144, 1030, 294, 4, 30, "Text"],
Cell[43441, 1036, 394, 10, 54, "Input"],
Cell[43838, 1048, 377, 7, 30, "Text"],
Cell[44218, 1057, 1067, 26, 138, "Input"],
Cell[45288, 1085, 1360, 37, 75, "Input"],
Cell[46651, 1124, 1639, 43, 54, "Input"],
Cell[48293, 1169, 226, 5, 30, "Text"],
Cell[48522, 1176, 626, 19, 32, "Input"],
Cell[49151, 1197, 734, 18, 32, "Input"],
Cell[49888, 1217, 630, 18, 54, "Input"],
Cell[50521, 1237, 362, 9, 32, "Input"],
Cell[50886, 1248, 274, 6, 30, "Text"],
Cell[51163, 1256, 803, 23, 32, "Input"],
Cell[51969, 1281, 562, 15, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52568, 1301, 203, 3, 64, "Section"],
Cell[52774, 1306, 2990, 76, 138, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[55801, 1387, 184, 3, 64, "Section"],
Cell[55988, 1392, 521, 9, 49, "Text"],
Cell[56512, 1403, 841, 22, 54, "Input"],
Cell[57356, 1427, 465, 9, 49, "Text"],
Cell[57824, 1438, 1186, 31, 32, "Input"],
Cell[59013, 1471, 421, 12, 32, "Input"],
Cell[59437, 1485, 258, 6, 30, "Text"],
Cell[59698, 1493, 1334, 32, 32, "Input"],
Cell[61035, 1527, 530, 14, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[61602, 1546, 173, 3, 64, "Section"],
Cell[61778, 1551, 598, 12, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62413, 1568, 167, 3, 64, "Section"],
Cell[62583, 1573, 358, 8, 32, "Input"],
Cell[62944, 1583, 471, 10, 32, "Input"],
Cell[63418, 1595, 154, 3, 32, "Input"],
Cell[63575, 1600, 559, 12, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64171, 1617, 160, 3, 64, "Section"],
Cell[64334, 1622, 347, 7, 30, "Text"],
Cell[64684, 1631, 807, 18, 32, "Input"],
Cell[65494, 1651, 273, 7, 32, "Input"],
Cell[65770, 1660, 796, 14, 32, "Input"],
Cell[66569, 1676, 1003, 17, 32, "Input"],
Cell[67575, 1695, 423, 11, 32, "Input"],
Cell[68001, 1708, 424, 11, 32, "Input"],
Cell[68428, 1721, 530, 10, 32, "Input"],
Cell[68961, 1733, 490, 13, 32, "Input"],
Cell[69454, 1748, 1966, 47, 75, "Input"],
Cell[71423, 1797, 530, 15, 32, "Input"],
Cell[71956, 1814, 481, 13, 32, "Input"],
Cell[72440, 1829, 973, 24, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73450, 1858, 277, 4, 64, "Section"],
Cell[73730, 1864, 1374, 31, 54, "Input"],
Cell[75107, 1897, 789, 17, 32, "Input"],
Cell[75899, 1916, 1443, 40, 54, "Input"],
Cell[77345, 1958, 836, 18, 32, "Input"],
Cell[78184, 1978, 1545, 40, 54, "Input"],
Cell[79732, 2020, 1666, 41, 75, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[81435, 2066, 279, 4, 64, "Section"],
Cell[81717, 2072, 1393, 30, 32, "Input"],
Cell[83113, 2104, 1443, 34, 54, "Input"],
Cell[84559, 2140, 434, 12, 32, "Input"],
Cell[84996, 2154, 483, 13, 32, "Input"],
Cell[85482, 2169, 291, 6, 30, "Text"],
Cell[85776, 2177, 635, 16, 32, "Input"],
Cell[86414, 2195, 310, 7, 30, "Text"],
Cell[86727, 2204, 431, 12, 35, "Input"],
Cell[87161, 2218, 2156, 52, 96, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[89354, 2275, 168, 3, 64, "Section"],
Cell[89525, 2280, 1084, 24, 32, "Input"],
Cell[90612, 2306, 1131, 25, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[91780, 2336, 228, 5, 64, "Section"],
Cell[92011, 2343, 2100, 53, 222, "Input"],
Cell[94114, 2398, 240, 5, 32, "Input"],
Cell[94357, 2405, 589, 16, 75, "Input"],
Cell[94949, 2423, 627, 15, 32, "Input"],
Cell[95579, 2440, 528, 16, 32, "Input"],
Cell[96110, 2458, 248, 6, 30, "Text"],
Cell[96361, 2466, 471, 10, 32, "Input"],
Cell[96835, 2478, 1470, 40, 96, "Input"],
Cell[98308, 2520, 293, 6, 30, "Text"],
Cell[98604, 2528, 535, 14, 32, "Input"],
Cell[99142, 2544, 535, 11, 32, "Input"],
Cell[99680, 2557, 530, 14, 32, "Input"],
Cell[100213, 2573, 583, 11, 32, "Input"],
Cell[100799, 2586, 1453, 40, 96, "Input"],
Cell[102255, 2628, 1461, 40, 96, "Input"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

