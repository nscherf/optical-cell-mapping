(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     51958,       1216]
NotebookOptionsPosition[     46426,       1085]
NotebookOutlinePosition[     46781,       1101]
CellTagsIndexPosition[     46738,       1098]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
Cell-accurate optical mapping across the entire developing heart\
\>", "Title",
 CellChangeTimes->{{3.714798636167549*^9, 3.714798643920143*^9}, {
  3.714798712696336*^9, 3.714798738212171*^9}, {3.7151020354743443`*^9, 
  3.715102049707464*^9}},ExpressionUUID->"31c9457c-cb3c-4c20-8fd8-\
3150cb557083"],

Cell[CellGroupData[{

Cell["Manual correction of detected cells", "Chapter",
 CellChangeTimes->{{3.715102052214654*^9, 3.71510207614849*^9}, {
  3.715102991867036*^9, 
  3.715102997212191*^9}},ExpressionUUID->"358c2114-d94a-46e0-a092-\
c2c9c7bec70a"],

Cell["\<\
First of all, we have to load the function definitions we will use throughout \
the analysis from an external file \[OpenCurlyDoubleQuote]./functions.m\
\[CloseCurlyDoubleQuote]. \
\>", "Text",
 CellChangeTimes->{{3.71479905160616*^9, 3.714799079753407*^9}, {
  3.714799184905587*^9, 
  3.714799191815287*^9}},ExpressionUUID->"b6e7b82c-eb4d-4c03-a6ea-\
47c68fc3eff8"],

Cell[BoxData[
 RowBox[{"Get", "[", 
  RowBox[{
   RowBox[{"NotebookDirectory", "[", "]"}], "<>", "\"\<functions.m\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.714753565651903*^9, 3.714753627586282*^9}, {
  3.71475374240552*^9, 
  3.714753753852852*^9}},ExpressionUUID->"35d3ca2b-24eb-44a7-9148-\
02ae96975cd1"],

Cell[BoxData[
 RowBox[{"root", "=", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"Most", "[", 
    RowBox[{"FileNameSplit", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], "]"}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.7150940884334507`*^9, 
  3.715094130164023*^9}},ExpressionUUID->"fceab38d-69ae-4614-bd89-\
49f1d801f8ed"],

Cell[CellGroupData[{

Cell["select dataset to analyze", "Subchapter",
 CellChangeTimes->{{3.7147987676717777`*^9, 
  3.714798774375169*^9}},ExpressionUUID->"d65c6f31-f365-48c7-b79a-\
fa7a0b9d03c4"],

Cell["\<\
We used the data from 5 different experiments for the analysis presented in \
the manuscript. An overview of the specific characteristics can be found in \
the datasheet: \[OpenCurlyQuote]datasets.xls\[CloseCurlyQuote].\
\>", "Text",
 CellChangeTimes->{{3.714799204745493*^9, 3.7147992066798887`*^9}, {
  3.714799676803508*^9, 
  3.714799758825612*^9}},ExpressionUUID->"899a18f5-b5b6-4009-857b-\
9353bd34c9b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"overview", " ", "=", " ", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"root", "<>", "\"\</data/datasets.xls\>\""}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"TableForm", "[", "overview", "]"}]}], "Input",
 CellChangeTimes->{{3.655478939679381*^9, 3.655478943841887*^9}, {
  3.6744588416113253`*^9, 3.6744588422202806`*^9}, {3.714754406080118*^9, 
  3.714754418749305*^9}, {3.714754861757915*^9, 3.7147548618474913`*^9}, {
  3.714755147550641*^9, 3.714755168941865*^9}, {3.715094139523484*^9, 
  3.7150941415661383`*^9}},ExpressionUUID->"9a038ddd-1de0-4240-b359-\
f17a16ebfbe9"],

Cell["\<\
Indicate number of dataset for analysis here. For illustration purposes we \
will use dataset 4:\
\>", "Text",
 CellChangeTimes->{{3.7147997690692167`*^9, 
  3.714799804298193*^9}},ExpressionUUID->"3f94acb6-516c-4d8e-b021-\
a21230a1319f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dataset", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{"dataset", "+", "1"}], "]"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.6616988049646997`*^9, 3.661698805331214*^9}, {
   3.661699570047418*^9, 3.6616995702067003`*^9}, {3.661699685846887*^9, 
   3.661699685942478*^9}, {3.661699877141048*^9, 3.6616998772590837`*^9}, {
   3.661700038393881*^9, 3.661700038652042*^9}, {3.661700334737482*^9, 
   3.661700334855748*^9}, {3.661700605938519*^9, 3.661700606231571*^9}, 
   3.6619510546485367`*^9, {3.6619511802396307`*^9, 3.661951180413286*^9}, {
   3.661951331335569*^9, 3.661951331636476*^9}, {3.661951466820656*^9, 
   3.661951467548032*^9}, {3.662017798157402*^9, 3.662017798392653*^9}, 
   3.662294981013357*^9, {3.662295567511388*^9, 3.662295567637494*^9}, {
   3.662295755753685*^9, 3.662295756270338*^9}, {3.6622962877254333`*^9, 
   3.6622962879874353`*^9}, 3.662299466893277*^9, {3.667719223646413*^9, 
   3.667719223899783*^9}, {3.668839781746401*^9, 3.668839782050395*^9}, {
   3.66883989569734*^9, 3.668839895879416*^9}, {3.668839926511546*^9, 
   3.668839926734028*^9}, {3.668839978261392*^9, 3.668839978517087*^9}, {
   3.668840023660438*^9, 3.668840024156015*^9}, {3.668841525230241*^9, 
   3.6688415253632174`*^9}, 3.669356367489142*^9, {3.66935876991918*^9, 
   3.669358770061015*^9}, 3.669358897906798*^9, {3.669435010597662*^9, 
   3.669435012732415*^9}, 3.6694360073190947`*^9, {3.669437184435788*^9, 
   3.669437184617661*^9}, {3.669437338830986*^9, 3.6694373390053043`*^9}, {
   3.6694602405174417`*^9, 3.669460240594811*^9}, 3.669963041105193*^9, {
   3.669963135421245*^9, 3.669963135524159*^9}, {3.669963174354681*^9, 
   3.669963174506352*^9}, {3.671251083346183*^9, 3.671251083586445*^9}, {
   3.674458853996708*^9, 3.674458856530954*^9}, 3.6744804031035023`*^9, {
   3.674480634219165*^9, 3.6744806344267893`*^9}, {3.6744808012621403`*^9, 
   3.674480801549555*^9}, {3.674527016704975*^9, 3.674527017024848*^9}, {
   3.674828691983982*^9, 3.674828692103085*^9}, 3.6748291933172207`*^9, {
   3.674829722144554*^9, 3.674829772996612*^9}, 3.674829818865635*^9, {
   3.674834417030634*^9, 3.6748344171492147`*^9}, {3.6748350739103813`*^9, 
   3.674835074348338*^9}, {3.6748353954284267`*^9, 3.674835395794833*^9}, {
   3.6748357058655777`*^9, 3.674835706110931*^9}, {3.67483675921109*^9, 
   3.6748367594101677`*^9}, {3.674836906042531*^9, 3.6748369061455927`*^9}, {
   3.674837015978903*^9, 3.6748370162086697`*^9}, {3.6748371149521923`*^9, 
   3.674837115511373*^9}, {3.674837675853219*^9, 3.674837676090798*^9}, {
   3.674837711393977*^9, 3.674837711513997*^9}, {3.6749005088508463`*^9, 
   3.6749005091307697`*^9}, 3.674905087058902*^9, {3.674905199933023*^9, 
   3.6749052002113132`*^9}, {3.674905275755107*^9, 3.674905277000918*^9}, {
   3.6749164728209677`*^9, 3.6749164730845346`*^9}, 
   3.714755249668799*^9},ExpressionUUID->"2b2d7475-8ae8-4d25-bcf2-\
9664949ab8e5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["global parameters for analysis", "Subchapter",
 CellChangeTimes->{{3.6554776678244247`*^9, 3.655477674305852*^9}, {
  3.714755785830852*^9, 3.7147557971447144`*^9}, {3.714798846964857*^9, 
  3.7147988555556602`*^9}},ExpressionUUID->"66f88635-1fdd-4ca9-8e19-\
75c4b30623fd"],

Cell[CellGroupData[{

Cell["dataset-specific information", "Section",
 CellChangeTimes->{{3.714798816970935*^9, 
  3.71479882729669*^9}},ExpressionUUID->"1ca3ee2e-77d2-4ae8-8663-\
a932e77da497"],

Cell[BoxData[{
 RowBox[{"fname", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "1"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"age", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "7"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"sampling", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "11"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"dx", " ", "=", " ", 
  RowBox[{"overview", "[", 
   RowBox[{"[", 
    RowBox[{
     RowBox[{"dataset", "+", "1"}], ",", "12"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"samplingCorrectionFactor", " ", "=", " ", 
   RowBox[{"400", "/", "sampling"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dz", "=", "1"}], ";"}]}], "Input",
 CellChangeTimes->{{3.655479021511404*^9, 3.655479133277341*^9}, 
   3.655479168135984*^9, {3.655487371971097*^9, 3.655487372234848*^9}, 
   3.655489483208609*^9, 3.655490299425108*^9, {3.655490644672233*^9, 
   3.655490644774046*^9}, {3.655533232865612*^9, 3.655533244600911*^9}, {
   3.655533519790916*^9, 3.6555335198944483`*^9}, {3.655533906040166*^9, 
   3.655533906133751*^9}, 3.655534024866321*^9, {3.655534159555071*^9, 
   3.6555341596589003`*^9}, {3.655535031717915*^9, 3.655535032235477*^9}, {
   3.655535862268572*^9, 3.655535862426869*^9}, {3.655535942509951*^9, 
   3.655535942644422*^9}, {3.655536065345306*^9, 3.6555360655276937`*^9}, {
   3.6555361482341633`*^9, 3.6555361483368587`*^9}, {3.655536269765544*^9, 
   3.655536270075507*^9}, {3.6555415495606613`*^9, 3.655541549640798*^9}, {
   3.655546248986149*^9, 3.655546249255982*^9}, {3.655546528727294*^9, 
   3.655546528990411*^9}, 3.655547057565041*^9, {3.655547266361803*^9, 
   3.655547266479578*^9}, {3.655547885678088*^9, 3.655547885805414*^9}, {
   3.6557198439299793`*^9, 3.655719844087031*^9}, 3.6564044086060553`*^9, {
   3.656686420679265*^9, 3.6566864207797823`*^9}, {3.657345184367741*^9, 
   3.6573451845996*^9}, {3.657348396415759*^9, 3.6573483965119677`*^9}, {
   3.657541782503058*^9, 3.6575417826103077`*^9}, {3.657542616905013*^9, 
   3.6575426170398703`*^9}, {3.6575429891181993`*^9, 3.657542989225912*^9}, {
   3.6578692973927727`*^9, 3.657869299550892*^9}, {3.657869901031538*^9, 
   3.657869901149851*^9}, {3.657870185950344*^9, 3.6578701870062017`*^9}, {
   3.657870596827506*^9, 3.6578705969307547`*^9}, 3.65787202419201*^9, {
   3.657880200309387*^9, 3.657880201402659*^9}, {3.657961274646967*^9, 
   3.657961274764965*^9}, 3.6579616775648937`*^9, {3.657963748537416*^9, 
   3.657963748800256*^9}, {3.6579640548584023`*^9, 3.6579640550397377`*^9}, 
   3.6579643966343813`*^9, {3.657964787982163*^9, 3.657964788219819*^9}, {
   3.657979061944572*^9, 3.657979062094222*^9}, 3.657979162259286*^9, {
   3.658147338047896*^9, 3.6581473383659687`*^9}, {3.658147493417946*^9, 
   3.658147493560783*^9}, 3.658147638759336*^9, {3.6581478330411663`*^9, 
   3.6581478331988783`*^9}, {3.65821538082722*^9, 3.6582153931599827`*^9}, 
   3.6582192307680483`*^9, {3.658220365191001*^9, 3.658220365332737*^9}, {
   3.6582210079488087`*^9, 3.658221008348791*^9}, {3.658221655028468*^9, 
   3.658221655189927*^9}, {3.6582232741247177`*^9, 3.658223274442339*^9}, {
   3.65822964285907*^9, 3.658229643000409*^9}, {3.658230129188501*^9, 
   3.6582301293063307`*^9}, 3.658230303590469*^9, {3.658232817686871*^9, 
   3.658232817892416*^9}, 3.6584768211696243`*^9, {3.658478158331215*^9, 
   3.658478158443344*^9}, {3.658478301113508*^9, 3.658478301271511*^9}, {
   3.658478619567287*^9, 3.658478634334279*^9}, 3.658478678334684*^9, 
   3.658480635788706*^9, {3.6584833229658003`*^9, 3.658483323290544*^9}, 
   3.658487522364092*^9, {3.65848758445532*^9, 3.658487584598105*^9}, {
   3.6584884171436453`*^9, 3.65848841727075*^9}, {3.6584884778234158`*^9, 
   3.6584884779652967`*^9}, {3.658489370996216*^9, 3.65848937113943*^9}, {
   3.658489595695405*^9, 3.658489597764439*^9}, {3.658489696338751*^9, 
   3.658489696617964*^9}, {3.658492009634116*^9, 3.6584920096793003`*^9}, {
   3.6585846660710297`*^9, 3.658584666459688*^9}, {3.658585292452421*^9, 
   3.6585852925298557`*^9}, {3.658641070359269*^9, 3.658641076886517*^9}, {
   3.65864165133532*^9, 3.658641653470298*^9}, {3.658642007326476*^9, 
   3.658642007459906*^9}, {3.6586449508479767`*^9, 3.658644951699139*^9}, {
   3.658645465735037*^9, 3.658645465860588*^9}, {3.658645807779954*^9, 
   3.658645808242608*^9}, {3.6586461054593973`*^9, 3.658646105602231*^9}, {
   3.658646252248713*^9, 3.658646252398234*^9}, {3.6586464277626553`*^9, 
   3.658646438984563*^9}, {3.658646475842163*^9, 3.6586464760399303`*^9}, {
   3.658647174512472*^9, 3.6586471746871433`*^9}, {3.658648216620336*^9, 
   3.658648217242033*^9}, {3.6586482863783407`*^9, 3.658648286447935*^9}, 
   3.658648320671286*^9, {3.658648376543421*^9, 3.658648377325749*^9}, {
   3.65864855434483*^9, 3.658648554512006*^9}, 3.658653751876148*^9, {
   3.658653899701229*^9, 3.6586538998589697`*^9}, {3.6586540747667093`*^9, 
   3.65865407487011*^9}, {3.658658204802387*^9, 3.658658205272847*^9}, {
   3.658659165924616*^9, 3.658659166540614*^9}, {3.658660253437405*^9, 
   3.658660253675522*^9}, {3.658660368441811*^9, 3.6586603685352793`*^9}, {
   3.658660440119746*^9, 3.658660444189699*^9}, {3.6586605337874117`*^9, 
   3.6586605339068832`*^9}, {3.6586609079532824`*^9, 3.658660984781398*^9}, {
   3.658661222709853*^9, 3.658661223071912*^9}, {3.659076139006364*^9, 
   3.6590761408454857`*^9}, {3.660997322314293*^9, 3.660997333792224*^9}, {
   3.661000426499291*^9, 3.661000426583947*^9}, {3.661083041977661*^9, 
   3.6610830426181097`*^9}, {3.661148823202075*^9, 3.661148823328382*^9}, 
   3.6611561390514297`*^9, {3.661156350058941*^9, 3.6611563501925793`*^9}, {
   3.661156635184662*^9, 3.661156635334544*^9}, {3.66115690177173*^9, 
   3.661156902306993*^9}, {3.661157229700251*^9, 3.661157229762034*^9}, {
   3.661686252124406*^9, 3.6616862523611393`*^9}, {3.6616895007618303`*^9, 
   3.661689507670538*^9}, 3.6616899414082108`*^9, {3.661691585493167*^9, 
   3.661691585986661*^9}, {3.6616980800173807`*^9, 3.661698081343108*^9}, {
   3.661698611497982*^9, 3.6616986209107933`*^9}, {3.661698653631297*^9, 
   3.661698653956615*^9}, {3.661698783858286*^9, 3.661698786101461*^9}, {
   3.6743717081272707`*^9, 3.674371708182232*^9}, {3.674460314580468*^9, 
   3.674460320395936*^9}, {3.6761887911742573`*^9, 3.6761888043279533`*^9}, {
   3.7147553309681807`*^9, 3.7147554873603983`*^9}, {3.714755592486487*^9, 
   3.71475563782023*^9}, {3.714755667982114*^9, 3.714755777847192*^9}, 
   3.7147558356960573`*^9, {3.714755930660054*^9, 3.7147559665389977`*^9}, 
   3.714799816502062*^9, {3.7166338079144278`*^9, 
   3.7166338081413307`*^9}},ExpressionUUID->"38fc0f45-8fde-439f-b1ed-\
bcca9a40a3a7"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.715266234139407*^9, 3.715266234915345*^9}, 
   3.716633806781546*^9},ExpressionUUID->"7575af98-b584-47d9-bc46-\
241b20123e48"]
}, Open  ]],

Cell[CellGroupData[{

Cell["settings for import and export", "Section",
 CellChangeTimes->{{3.714798830927537*^9, 
  3.714798844282794*^9}},ExpressionUUID->"e113c824-f144-487f-a07b-\
657428bf7027"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"directory", " ", "prefix", " ", "for", " ", "import"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"prefix", " ", "=", " ", 
     RowBox[{"root", "<>", "\"\</results/\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "labelled", " ", "volume", " ", "of", " ", "detected", " ", "cells"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"map", " ", "=", " ", 
     RowBox[{
     "prefix", "<>", "\"\<myl7-H2A-labels/\>\"", "<>", "fname", "<>", 
      "\"\<-filtered.h5\>\""}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7147558009952583`*^9, 3.714755918798725*^9}, {
   3.714756001531382*^9, 3.7147560132343807`*^9}, 3.714798885787745*^9, {
   3.715094196677239*^9, 3.7150942422278*^9}, {3.715094349599399*^9, 
   3.715094420859765*^9}, {3.715094634608032*^9, 3.715094639553718*^9}, {
   3.7151030760213413`*^9, 3.715103083819034*^9}, 3.715103648962269*^9, {
   3.715103777002347*^9, 3.715103777029064*^9}, {3.7151039199726067`*^9, 
   3.715103923792292*^9}},ExpressionUUID->"13281185-582d-49e2-9447-\
09bb8be6af76"]
}, Open  ]],

Cell[CellGroupData[{

Cell["general parameters", "Section",
 CellChangeTimes->{{3.714798868879168*^9, 
  3.7147988770398684`*^9}},ExpressionUUID->"993d3033-0176-4f0f-a39a-\
878f7cf81cc0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"settings", " ", "for", " ", "exported", " ", "graphics"}], "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"maxRes", "=", "600"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imsize", "=", " ", "600"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"imres", " ", "=", " ", "300"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.655479021511404*^9, 3.655479133277341*^9}, 
   3.655479168135984*^9, {3.655487371971097*^9, 3.655487372234848*^9}, 
   3.655489483208609*^9, 3.655490299425108*^9, {3.655490644672233*^9, 
   3.655490644774046*^9}, {3.655533232865612*^9, 3.655533244600911*^9}, {
   3.655533519790916*^9, 3.6555335198944483`*^9}, {3.655533906040166*^9, 
   3.655533906133751*^9}, 3.655534024866321*^9, {3.655534159555071*^9, 
   3.6555341596589003`*^9}, {3.655535031717915*^9, 3.655535032235477*^9}, {
   3.655535862268572*^9, 3.655535862426869*^9}, {3.655535942509951*^9, 
   3.655535942644422*^9}, {3.655536065345306*^9, 3.6555360655276937`*^9}, {
   3.6555361482341633`*^9, 3.6555361483368587`*^9}, {3.655536269765544*^9, 
   3.655536270075507*^9}, {3.6555415495606613`*^9, 3.655541549640798*^9}, {
   3.655546248986149*^9, 3.655546249255982*^9}, {3.655546528727294*^9, 
   3.655546528990411*^9}, 3.655547057565041*^9, {3.655547266361803*^9, 
   3.655547266479578*^9}, {3.655547885678088*^9, 3.655547885805414*^9}, {
   3.6557198439299793`*^9, 3.655719844087031*^9}, 3.6564044086060553`*^9, {
   3.656686420679265*^9, 3.6566864207797823`*^9}, {3.657345184367741*^9, 
   3.6573451845996*^9}, {3.657348396415759*^9, 3.6573483965119677`*^9}, {
   3.657541782503058*^9, 3.6575417826103077`*^9}, {3.657542616905013*^9, 
   3.6575426170398703`*^9}, {3.6575429891181993`*^9, 3.657542989225912*^9}, {
   3.6578692973927727`*^9, 3.657869299550892*^9}, {3.657869901031538*^9, 
   3.657869901149851*^9}, {3.657870185950344*^9, 3.6578701870062017`*^9}, {
   3.657870596827506*^9, 3.6578705969307547`*^9}, 3.65787202419201*^9, {
   3.657880200309387*^9, 3.657880201402659*^9}, {3.657961274646967*^9, 
   3.657961274764965*^9}, 3.6579616775648937`*^9, {3.657963748537416*^9, 
   3.657963748800256*^9}, {3.6579640548584023`*^9, 3.6579640550397377`*^9}, 
   3.6579643966343813`*^9, {3.657964787982163*^9, 3.657964788219819*^9}, {
   3.657979061944572*^9, 3.657979062094222*^9}, 3.657979162259286*^9, {
   3.658147338047896*^9, 3.6581473383659687`*^9}, {3.658147493417946*^9, 
   3.658147493560783*^9}, 3.658147638759336*^9, {3.6581478330411663`*^9, 
   3.6581478331988783`*^9}, {3.65821538082722*^9, 3.6582153931599827`*^9}, 
   3.6582192307680483`*^9, {3.658220365191001*^9, 3.658220365332737*^9}, {
   3.6582210079488087`*^9, 3.658221008348791*^9}, {3.658221655028468*^9, 
   3.658221655189927*^9}, {3.6582232741247177`*^9, 3.658223274442339*^9}, {
   3.65822964285907*^9, 3.658229643000409*^9}, {3.658230129188501*^9, 
   3.6582301293063307`*^9}, 3.658230303590469*^9, {3.658232817686871*^9, 
   3.658232817892416*^9}, 3.6584768211696243`*^9, {3.658478158331215*^9, 
   3.658478158443344*^9}, {3.658478301113508*^9, 3.658478301271511*^9}, {
   3.658478619567287*^9, 3.658478634334279*^9}, 3.658478678334684*^9, 
   3.658480635788706*^9, {3.6584833229658003`*^9, 3.658483323290544*^9}, 
   3.658487522364092*^9, {3.65848758445532*^9, 3.658487584598105*^9}, {
   3.6584884171436453`*^9, 3.65848841727075*^9}, {3.6584884778234158`*^9, 
   3.6584884779652967`*^9}, {3.658489370996216*^9, 3.65848937113943*^9}, {
   3.658489595695405*^9, 3.658489597764439*^9}, {3.658489696338751*^9, 
   3.658489696617964*^9}, {3.658492009634116*^9, 3.6584920096793003`*^9}, {
   3.6585846660710297`*^9, 3.658584666459688*^9}, {3.658585292452421*^9, 
   3.6585852925298557`*^9}, {3.658641070359269*^9, 3.658641076886517*^9}, {
   3.65864165133532*^9, 3.658641653470298*^9}, {3.658642007326476*^9, 
   3.658642007459906*^9}, {3.6586449508479767`*^9, 3.658644951699139*^9}, {
   3.658645465735037*^9, 3.658645465860588*^9}, {3.658645807779954*^9, 
   3.658645808242608*^9}, {3.6586461054593973`*^9, 3.658646105602231*^9}, {
   3.658646252248713*^9, 3.658646252398234*^9}, {3.6586464277626553`*^9, 
   3.658646438984563*^9}, {3.658646475842163*^9, 3.6586464760399303`*^9}, {
   3.658647174512472*^9, 3.6586471746871433`*^9}, {3.658648216620336*^9, 
   3.658648217242033*^9}, {3.6586482863783407`*^9, 3.658648286447935*^9}, 
   3.658648320671286*^9, {3.658648376543421*^9, 3.658648377325749*^9}, {
   3.65864855434483*^9, 3.658648554512006*^9}, 3.658653751876148*^9, {
   3.658653899701229*^9, 3.6586538998589697`*^9}, {3.6586540747667093`*^9, 
   3.65865407487011*^9}, {3.658658204802387*^9, 3.658658205272847*^9}, {
   3.658659165924616*^9, 3.658659166540614*^9}, {3.658660253437405*^9, 
   3.658660253675522*^9}, {3.658660368441811*^9, 3.6586603685352793`*^9}, {
   3.658660440119746*^9, 3.658660444189699*^9}, {3.6586605337874117`*^9, 
   3.6586605339068832`*^9}, {3.6586609079532824`*^9, 3.658660984781398*^9}, {
   3.658661222709853*^9, 3.658661223071912*^9}, {3.659076139006364*^9, 
   3.6590761408454857`*^9}, {3.660997322314293*^9, 3.660997333792224*^9}, {
   3.661000426499291*^9, 3.661000426583947*^9}, {3.661083041977661*^9, 
   3.6610830426181097`*^9}, {3.661148823202075*^9, 3.661148823328382*^9}, 
   3.6611561390514297`*^9, {3.661156350058941*^9, 3.6611563501925793`*^9}, {
   3.661156635184662*^9, 3.661156635334544*^9}, {3.66115690177173*^9, 
   3.661156902306993*^9}, {3.661157229700251*^9, 3.661157229762034*^9}, {
   3.661686252124406*^9, 3.6616862523611393`*^9}, {3.6616895007618303`*^9, 
   3.661689507670538*^9}, 3.6616899414082108`*^9, {3.661691585493167*^9, 
   3.661691585986661*^9}, {3.6616980800173807`*^9, 3.661698081343108*^9}, {
   3.661698611497982*^9, 3.6616986209107933`*^9}, {3.661698653631297*^9, 
   3.661698653956615*^9}, {3.661698783858286*^9, 3.661698786101461*^9}, {
   3.6743717081272707`*^9, 3.674371708182232*^9}, {3.674460314580468*^9, 
   3.674460320395936*^9}, {3.6761887911742573`*^9, 3.6761888043279533`*^9}, {
   3.7147553309681807`*^9, 3.7147554873603983`*^9}, {3.714755592486487*^9, 
   3.71475563782023*^9}, {3.714755667982114*^9, 3.714755777847192*^9}, 
   3.7147558356960573`*^9, {3.714755930660054*^9, 3.714755996874426*^9}, {
   3.714756672414266*^9, 3.7147567661596603`*^9}, 3.714757078332003*^9, {
   3.714758081453981*^9, 3.714758097886653*^9}, {3.7147988798184967`*^9, 
   3.714798891764056*^9}, {3.715103091206563*^9, 
   3.715103094984857*^9}},ExpressionUUID->"63a9e1c8-926c-463f-bb0b-\
3b6bfa9a01b6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["import data", "Section",
 CellChangeTimes->{{3.714798914835228*^9, 3.71479891797869*^9}, {
  3.714799901334991*^9, 3.714799925419663*^9}, {3.715103111613641*^9, 
  3.715103112073907*^9}},ExpressionUUID->"d253b9d0-95ba-4665-9e36-\
1ca750f24c70"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"heart", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"map", ",", "\"\</img\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"img", "=", 
   RowBox[{"Image3D", "[", 
    RowBox[{"heart", ",", "\"\<Bit16\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lab", " ", "=", " ", 
   RowBox[{"ComponentMeasurements", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ImageData", "[", 
        RowBox[{"img", ",", "\"\<Bit16\>\""}], "]"}], ",", "img"}], "}"}], 
     ",", 
     RowBox[{"{", "\"\<Label\>\"", "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cnts", " ", "=", " ", 
   RowBox[{"ComponentMeasurements", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ImageData", "[", 
        RowBox[{"img", ",", "\"\<Bit16\>\""}], "]"}], ",", "img"}], "}"}], 
     ",", 
     RowBox[{"{", "\"\<Centroid\>\"", "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"centroids", "=", 
   RowBox[{"Join", "@@", 
    RowBox[{"(", 
     RowBox[{"Last", "/@", "cnts"}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.715103636864361*^9, 3.715103637073138*^9}, {
  3.715265838875019*^9, 3.715265876315221*^9}, {3.715266350713511*^9, 
  3.715266352438857*^9}},ExpressionUUID->"e7982a50-45bf-4c11-92f9-\
05cf8399d408"],

Cell[BoxData[
 RowBox[{
  RowBox[{"img", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image3D", "[", 
     RowBox[{"Import", "[", 
      RowBox[{
      "root", "<>", "\"\</data/myl7-H2A-mCherry/\>\"", "<>", "fname", "<>", 
       "\"\<.tif\>\""}], "]"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.715103167770746*^9, 
  3.715103226470489*^9}},ExpressionUUID->"99345e31-5586-4ffb-be63-\
25d16e286287"],

Cell[BoxData[
 RowBox[{
  RowBox[{"imdata", "=", 
   RowBox[{"ImageData", "[", "img", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7151032274607573`*^9, 
  3.715103252844111*^9}},ExpressionUUID->"809a82b7-4875-4ac5-914c-\
05bb76e26e95"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"nz", ",", "ny", ",", "nx"}], "}"}], "=", 
  RowBox[{"Dimensions", "[", "imdata", "]"}]}]], "Input",
 CellChangeTimes->{{3.715103263120743*^9, 
  3.715103272261311*^9}},ExpressionUUID->"78fca7f2-fe26-4ae5-8aa0-\
c82b560baaba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mymaxXY", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"imdata", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "ny"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "nx"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.658656704138801*^9, 3.658656704513769*^9}, {
  3.658656787156839*^9, 3.658656859416996*^9}, {3.6586569192199183`*^9, 
  3.6586569192793007`*^9}, {3.660996501167457*^9, 3.660996512613976*^9}, {
  3.715103290987767*^9, 
  3.715103293065061*^9}},ExpressionUUID->"1639efd2-78d6-44e7-a202-\
83a5c5f8ea91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mymaxXZ", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"imdata", "[", 
       RowBox[{"[", 
        RowBox[{"k", ",", ";;", ",", "j"}], "]"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "nz"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "nx"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.658656925912979*^9, 3.658656953838274*^9}, {
   3.658657048753731*^9, 3.6586570516059113`*^9}, {3.658657138261396*^9, 
   3.658657149336636*^9}, {3.660996515463202*^9, 3.6609965223084707`*^9}, 
   3.7151032979172573`*^9},ExpressionUUID->"5b96c8ac-ae77-4ad8-903b-\
0dbd682b770f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mymaxYZ", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"imdata", "[", 
       RowBox[{"[", 
        RowBox[{"k", ",", "i", ",", ";;"}], "]"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "ny"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", "1", ",", "nz"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.659691707569076*^9, 3.6596917287582693`*^9}, {
   3.6596917748499002`*^9, 3.659691778845508*^9}, {3.659692095598588*^9, 
   3.6596921303067217`*^9}, {3.659694759625218*^9, 3.659694764083967*^9}, {
   3.660996526064126*^9, 3.66099652842947*^9}, 
   3.715103299091827*^9},ExpressionUUID->"633713a8-0376-4851-9002-\
0d24f78d1bae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"imXY", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"ColorNegate", "[", 
     RowBox[{"Image", "[", "mymaxXY", "]"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6586568633257933`*^9, 3.6586568994474077`*^9}, {
   3.6586569695596046`*^9, 3.658656969686701*^9}, {3.658657161890037*^9, 
   3.658657163015397*^9}, 
   3.715265902739668*^9},ExpressionUUID->"b018b808-6e70-4411-ad7d-\
bc947f0c5a59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"imXZ", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"ColorNegate", "[", 
     RowBox[{"Image", "[", 
      RowBox[{"Reverse", "@", "mymaxXZ"}], "]"}], "]"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.658656962901198*^9, 3.658656963854039*^9}, {
   3.658657025316238*^9, 3.658657060090962*^9}, {3.658657165160075*^9, 
   3.6586571673533783`*^9}, {3.659698027423143*^9, 3.659698031158033*^9}, 
   3.715265904629403*^9},ExpressionUUID->"1a247963-03e6-45a0-bafd-\
faae4428a23f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"imYZ", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"ColorNegate", "[", 
     RowBox[{"Image", "[", "mymaxYZ", "]"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6596917368715687`*^9, 3.6596918200060883`*^9}, 
   3.659692012544744*^9, 
   3.715265906704135*^9},ExpressionUUID->"9c842f1c-eef0-4822-b8e7-\
ee6118183819"]
}, Open  ]],

Cell[CellGroupData[{

Cell["process cell detections", "Section",
 CellChangeTimes->{{3.715103345803216*^9, 
  3.715103355301764*^9}},ExpressionUUID->"c8ac906e-bfa9-4594-a2bc-\
cc0b3a88f8aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mimg", "=", 
   RowBox[{"Image", "/@", 
    RowBox[{"ImageData", "[", "img", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.715103368358674*^9, 
  3.715103368551818*^9}},ExpressionUUID->"afe3b14f-586c-4a63-9807-\
1168113ad276"],

Cell[BoxData[
 RowBox[{
  RowBox[{"myPts2", "=", 
   RowBox[{"{", "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6596985510860443`*^9, 
  3.6596985542315187`*^9}},ExpressionUUID->"03f67322-6b73-4ec5-b76f-\
521a2924b1a6"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "showSlice", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"showSlice", "[", 
   RowBox[{
    RowBox[{"Dynamic", "[", "x_", "]"}], ",", 
    RowBox[{"Dynamic", "[", "y_", "]"}], ",", 
    RowBox[{"Dynamic", "[", "z_", "]"}]}], "]"}], ":=", 
  RowBox[{"DynamicModule", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"mimg", "[", 
       RowBox[{"[", "z", "]"}], "]"}], ",", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", 
        RowBox[{"Green", ",", 
         RowBox[{"Point", "[", 
          RowBox[{"{", 
           RowBox[{"x", ",", "y"}], "}"}], "]"}]}], "}"}], "]"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"showSlice", "[", 
   RowBox[{"Dynamic", "[", "z_", "]"}], "]"}], ":=", 
  RowBox[{"DynamicModule", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"mimg", "[", 
     RowBox[{"[", "z", "]"}], "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.659760356936022*^9, 3.65976039310411*^9}, {
  3.715103401489951*^9, 
  3.715103401711411*^9}},ExpressionUUID->"17b3e078-71ab-4fe0-8222-\
c120ccdde2f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"transformedCentroids", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"nx", "-", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", 
       RowBox[{"ny", "-", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"nz", "-", 
        RowBox[{"#", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], "&"}], "/@", 
    "centroids"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.715266153923297*^9, 3.715266156011396*^9}, {
  3.715266211251658*^9, 3.715266217506978*^9}, {3.715266265165807*^9, 
  3.715266267556245*^9}, {3.7152663666505117`*^9, 3.715266376858983*^9}, {
  3.715269662018116*^9, 
  3.715269714240741*^9}},ExpressionUUID->"b19dd5ec-3770-4a39-8f02-\
d01ff41ff57c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"centroidsBackup", "=", "transformedCentroids"}], ";"}]], "Input",
 CellChangeTimes->{{3.659783129214672*^9, 3.659783133902348*^9}, {
  3.715266446837344*^9, 3.71526645494878*^9}, {3.715269719496776*^9, 
  3.7152697235208273`*^9}},ExpressionUUID->"d66106a5-f9f9-412b-bb84-\
3c898fd24cc8"],

Cell[BoxData[
 RowBox[{"myPts2", "=", 
  RowBox[{"{", "}"}]}]], "Input",
 CellChangeTimes->{{3.659781747505336*^9, 
  3.65978175494737*^9}},ExpressionUUID->"60bb4b65-9fb3-4765-88da-\
8705cd5011fb"],

Cell[BoxData[
 RowBox[{"delete", "=", 
  RowBox[{"{", "}"}]}]], "Input",
 CellChangeTimes->{{3.659781860548962*^9, 
  3.659781862064587*^9}},ExpressionUUID->"346effa2-2c40-4a0d-b0d7-\
e96f1515dc5a"],

Cell[BoxData[
 RowBox[{"DynamicModule", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x", "=", "10"}], ",", 
     RowBox[{"y", "=", "10"}], ",", 
     RowBox[{"z", "=", "10"}], ",", 
     RowBox[{"myPts", "=", "myPts2"}], ",", " ", "xi", ",", "yi", ",", "zi"}],
     "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"Column", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"SetterBar", "[", 
           RowBox[{
            RowBox[{"Dynamic", "[", "i", "]"}], ",", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "@", "transformedCentroids"}], "]"}], ",", 
            RowBox[{"Appearance", " ", "\[Rule]", " ", 
             RowBox[{"\"\<Horizontal\>\"", " ", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"5", ",", "Automatic"}], "}"}]}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Dynamic", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", 
             RowBox[{"transformedCentroids", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "}"}]}], "}"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Button", "[", 
           RowBox[{"\"\<append point\>\"", ",", 
            RowBox[{"myPts2", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"myPts2", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}]}]}], "]"}], 
          ",", 
          RowBox[{"Button", "[", 
           RowBox[{"\"\<delete point\>\"", ",", 
            RowBox[{"transformedCentroids", "=", 
             RowBox[{"DeleteCases", "[", " ", 
              RowBox[{"transformedCentroids", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "]"}]}]}], "]"}], 
          ",", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"{", 
            RowBox[{"x", ",", "y", ",", "z"}], "}"}], "]"}]}], "}"}], "]"}], 
       ",", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"imXY", ",", 
            RowBox[{"Graphics", "[", 
             RowBox[{"Locator", "[", 
              RowBox[{"Dynamic", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y"}], "}"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"Graphics", "[", 
             RowBox[{"{", 
              RowBox[{"Red", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Point", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@",
                 "myPts"}]}], "}"}], "]"}], ",", 
            RowBox[{"Graphics", "[", 
             RowBox[{"{", 
              RowBox[{"Blue", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Point", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@",
                 "transformedCentroids"}]}], "}"}], "]"}]}], "]"}], ",", 
          RowBox[{"Show", "[", 
           RowBox[{"imYZ", ",", 
            RowBox[{"Graphics", "[", 
             RowBox[{"{", 
              RowBox[{"Green", ",", 
               RowBox[{"Circle", "[", 
                RowBox[{
                 RowBox[{"Dynamic", "[", 
                  RowBox[{"{", 
                   RowBox[{"z", ",", "y"}], "}"}], "]"}], ",", "3"}], "]"}]}],
               "}"}], "]"}], ",", 
            RowBox[{"Graphics", "[", 
             RowBox[{"{", 
              RowBox[{"Red", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Point", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@",
                 "myPts"}]}], "}"}], "]"}], ",", 
            RowBox[{"Graphics", "[", 
             RowBox[{"{", 
              RowBox[{"Blue", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Point", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@",
                 "transformedCentroids"}]}], "}"}], "]"}]}], "]"}]}], "}"}], 
        "]"}], ",", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{"Show", "[", 
          RowBox[{"imXZ", ",", 
           RowBox[{"Graphics", "[", 
            RowBox[{"Locator", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", 
               RowBox[{"{", 
                RowBox[{"x", ",", "z"}], "}"}], "]"}], ",", 
              RowBox[{"LocatorRegion", "\[Rule]", "Automatic"}]}], "]"}], 
            "]"}], ",", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Point", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@",
                "myPts"}]}], "}"}], "]"}], ",", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{"Blue", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Point", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@",
                "transformedCentroids"}]}], "}"}], "]"}]}], "]"}], "}"}], 
        "]"}], ",", 
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{"Dynamic", "[", 
          RowBox[{"showSlice", "[", 
           RowBox[{
            RowBox[{"Dynamic", "[", "x", "]"}], ",", 
            RowBox[{"Dynamic", "[", "y", "]"}], ",", 
            RowBox[{"Dynamic", "[", 
             RowBox[{"Max", "[", 
              RowBox[{"1", ",", 
               RowBox[{"Round", "[", "z", "]"}]}], "]"}], "]"}]}], "]"}], 
          "]"}], "}"}], "]"}]}], "}"}], "]"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.659690577114291*^9, 3.6596906039802723`*^9}, {
   3.659690646657933*^9, 3.659690989269721*^9}, {3.659691076066552*^9, 
   3.659691109102868*^9}, {3.659691139694821*^9, 3.659691154452232*^9}, {
   3.6596912366394653`*^9, 3.6596912548704443`*^9}, {3.659691290608712*^9, 
   3.659691317573222*^9}, {3.659691370996407*^9, 3.65969143691131*^9}, {
   3.6596918756674757`*^9, 3.659691883367374*^9}, {3.6596919516140327`*^9, 
   3.659691953124102*^9}, {3.659692175634733*^9, 3.659692176984901*^9}, {
   3.659692311195033*^9, 3.659692311478778*^9}, 3.6596923848973913`*^9, {
   3.659694787311904*^9, 3.659694788483376*^9}, {3.659697783322124*^9, 
   3.6596978162179203`*^9}, {3.659698133116205*^9, 3.659698160827221*^9}, {
   3.6596982963177023`*^9, 3.6596983813199673`*^9}, {3.659698489243569*^9, 
   3.659698493923553*^9}, {3.659698565265181*^9, 3.659698589223206*^9}, {
   3.65969882087094*^9, 3.6596988230050783`*^9}, {3.659698962880645*^9, 
   3.659698965702318*^9}, {3.6596996853994093`*^9, 3.6596997183736486`*^9}, {
   3.659759454506789*^9, 3.6597596317027807`*^9}, {3.659760209266671*^9, 
   3.659760243958261*^9}, 3.6597603851170177`*^9, {3.6597604344552298`*^9, 
   3.6597604513407707`*^9}, {3.6597606120669937`*^9, 3.659760622517907*^9}, {
   3.659760685906537*^9, 3.659760731926976*^9}, {3.659760778204789*^9, 
   3.659760782276688*^9}, {3.659760911641528*^9, 3.659760955628318*^9}, {
   3.659761314035488*^9, 3.659761332514309*^9}, {3.6597614070551567`*^9, 
   3.65976156922501*^9}, {3.659779551786811*^9, 3.6597795733445377`*^9}, {
   3.6597796072393427`*^9, 3.659779632231435*^9}, {3.6597801738747663`*^9, 
   3.659780181927607*^9}, {3.659780212000223*^9, 3.659780292573538*^9}, {
   3.6597803287975817`*^9, 3.659780359163926*^9}, {3.659780390004133*^9, 
   3.6597805244709272`*^9}, {3.659780691916073*^9, 3.659780836174698*^9}, {
   3.659780883215947*^9, 3.659780887165379*^9}, {3.659781396674019*^9, 
   3.6597814045111637`*^9}, {3.65978143988731*^9, 3.659781540091441*^9}, {
   3.65978158549785*^9, 3.659781628105722*^9}, {3.659782416837009*^9, 
   3.659782475249816*^9}, {3.6597825106201057`*^9, 3.659782511992969*^9}, {
   3.659782619879558*^9, 3.659782633661747*^9}, {3.6597831415138617`*^9, 
   3.659783155672035*^9}, {3.659783245822906*^9, 3.659783246885427*^9}, {
   3.6597832869005117`*^9, 3.659783310595818*^9}, {3.7152664041115313`*^9, 
   3.715266435057754*^9}, {3.715269757693736*^9, 
   3.715269764956427*^9}},ExpressionUUID->"ffdaed48-1505-4d28-9155-\
886dc05cc536"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
create label regions from centroids and export label image as TIFF stack\
\>", "Section",
 CellChangeTimes->{{3.716641128720998*^9, 
  3.716641176670639*^9}},ExpressionUUID->"16135b2d-7961-4d49-b4bf-\
6e450dd1687f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"curatedCentroids", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{"transformedCentroids", ",", " ", "myPts2"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.659857313445284*^9, 3.6598573338964577`*^9}, {
  3.715269803346136*^9, 3.715269806191887*^9}, {3.715269847864079*^9, 
  3.715269857733486*^9}},ExpressionUUID->"b1d0f6e6-f1cf-4244-96a7-\
eb945b65dfad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"transformedCuratedCentroids", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"ny", "-", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "&"}], "/@", 
    "curatedCentroids"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.716640452344178*^9, 
  3.716640458506733*^9}},ExpressionUUID->"c422e58d-b63c-491b-9fe6-\
2757c3425dd5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"smat", " ", "=", " ", 
   RowBox[{"SparseArray", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[Rule]", "1"}], "&"}], "/@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Round", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@", 
        "transformedCuratedCentroids"}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"nx", ",", "ny", ",", "nz"}], "}"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.716640520826831*^9, 
  3.71664053420543*^9}},ExpressionUUID->"85aa19f1-6e57-41d6-bc84-\
28d9f9185553"],

Cell[BoxData[
 RowBox[{
  RowBox[{"seedimg", "=", 
   RowBox[{"Image3D", "[", "smat", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.716634212779109*^9, 
  3.716634248273747*^9}},ExpressionUUID->"c411365c-b573-48bf-848f-\
d5c4da901291"],

Cell[BoxData[
 RowBox[{
  RowBox[{"regions", "=", 
   RowBox[{"Binarize", "[", 
    RowBox[{
     RowBox[{"DistanceTransform", "[", 
      RowBox[{"ColorNegate", "[", "seedimg", "]"}], "]"}], ",", "5"}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.659857662017346*^9, 
  3.659857698879839*^9}},ExpressionUUID->"6f67914f-cfa0-435c-8c47-\
7b441b066d6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"regions", " ", "=", " ", 
   RowBox[{"ColorNegate", "@", "regions"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.659857736585752*^9, 3.659857737367132*^9}, {
  3.659857830860753*^9, 
  3.659857836183193*^9}},ExpressionUUID->"c373f1ec-51ba-44a8-adcb-\
79364037d407"],

Cell[BoxData[
 RowBox[{
  RowBox[{"iw", "=", 
   RowBox[{"ColorNegate", "@", 
    RowBox[{"ImageAdjust", "@", 
     RowBox[{"DistanceTransform", "@", "regions"}]}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6598581799253902`*^9, 
  3.659858182684021*^9}},ExpressionUUID->"678e9cd0-2ddf-46a9-9683-\
d2b7012b5acc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cwm", "=", 
   RowBox[{"WatershedComponents", "[", 
    RowBox[{"iw", ",", "seedimg"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cwm", "*=", 
   RowBox[{"ImageData", "[", "regions", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.659858188283841*^9, 3.6598581942599773`*^9}, {
   3.6598585697017117`*^9, 3.6598585728759947`*^9}, 3.659859621095312*^9, 
   3.715270051643373*^9},ExpressionUUID->"ab351ab1-8d15-48b1-b0d2-\
b06592d2fc0e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"labelimg", " ", "=", " ", 
   RowBox[{"Image3D", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"cwm", ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], ",", 
     "\"\<Bit16\>\""}], "]"}]}], ";"}]], "Input",ExpressionUUID->"1d7ab097-\
5485-4dae-8d72-6abceeaa2070"],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{
   "root", "<>", "\"\</results/myl7-H2A-processed-labels/\>\"", "<>", "fname",
     "<>", "\"\<-curated-labels-2.tif\>\""}], ",", "labelimg"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.660995509484178*^9, 3.660995528958095*^9}, {
  3.660996826157775*^9, 3.660996837229179*^9}, {3.6609973026366777`*^9, 
  3.6609973035210533`*^9}, {3.716639545795466*^9, 3.7166395773245487`*^9}, {
  3.7166396074166183`*^9, 
  3.716639635261492*^9}},ExpressionUUID->"d2172e26-65d2-472d-abc7-\
dd67acad6631"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1440, 852},
WindowMargins->{{-1, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (April 27, \
2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 312, 6, 92, "Title", "ExpressionUUID" -> \
"31c9457c-cb3c-4c20-8fd8-3150cb557083"],
Cell[CellGroupData[{
Cell[917, 32, 228, 4, 65, "Chapter", "ExpressionUUID" -> \
"358c2114-d94a-46e0-a092-c2c9c7bec70a"],
Cell[1148, 38, 377, 8, 30, "Text", "ExpressionUUID" -> \
"b6e7b82c-eb4d-4c03-a6ea-47c68fc3eff8"],
Cell[1528, 48, 315, 8, 32, "Input", "ExpressionUUID" -> \
"35d3ca2b-24eb-44a7-9148-02ae96975cd1"],
Cell[1846, 58, 337, 9, 32, "Input", "ExpressionUUID" -> \
"fceab38d-69ae-4614-bd89-49f1d801f8ed"],
Cell[CellGroupData[{
Cell[2208, 71, 175, 3, 63, "Subchapter", "ExpressionUUID" -> \
"d65c6f31-f365-48c7-b79a-fa7a0b9d03c4"],
Cell[2386, 76, 420, 8, 30, "Text", "ExpressionUUID" -> \
"899a18f5-b5b6-4009-857b-9353bd34c9b2"],
Cell[2809, 86, 673, 13, 54, "Input", "ExpressionUUID" -> \
"9a038ddd-1de0-4240-b359-f17a16ebfbe9"],
Cell[3485, 101, 248, 6, 30, "Text", "ExpressionUUID" -> \
"3f94acb6-516c-4d8e-b021-a21230a1319f"],
Cell[3736, 109, 3049, 46, 54, "Input", "ExpressionUUID" -> \
"2b2d7475-8ae8-4d25-bcf2-9664949ab8e5"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6822, 160, 279, 4, 63, "Subchapter", "ExpressionUUID" -> \
"66f88635-1fdd-4ca9-8e19-75c4b30623fd"],
Cell[CellGroupData[{
Cell[7126, 168, 172, 3, 64, "Section", "ExpressionUUID" -> \
"1ca3ee2e-77d2-4ae8-8663-a932e77da497"],
Cell[7301, 173, 6930, 111, 138, "Input", "ExpressionUUID" -> \
"38fc0f45-8fde-439f-b1ed-bcca9a40a3a7"],
Cell[14234, 286, 175, 3, 32, "Input", "ExpressionUUID" -> \
"7575af98-b584-47d9-bc46-241b20123e48"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14446, 294, 175, 3, 64, "Section", "ExpressionUUID" -> \
"e113c824-f144-487f-a07b-657428bf7027"],
Cell[14624, 299, 1140, 26, 96, "Input", "ExpressionUUID" -> \
"13281185-582d-49e2-9447-09bb8be6af76"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15801, 330, 165, 3, 64, "Section", "ExpressionUUID" -> \
"993d3033-0176-4f0f-a39a-878f7cf81cc0"],
Cell[15969, 335, 6559, 96, 117, "Input", "ExpressionUUID" -> \
"63a9e1c8-926c-463f-bb0b-3b6bfa9a01b6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22565, 436, 250, 4, 64, "Section", "ExpressionUUID" -> \
"d253b9d0-95ba-4665-9e36-1ca750f24c70"],
Cell[22818, 442, 1364, 41, 117, "Input", "ExpressionUUID" -> \
"e7982a50-45bf-4c11-92f9-05cf8399d408"],
Cell[24185, 485, 419, 11, 32, "Input", "ExpressionUUID" -> \
"99345e31-5586-4ffb-be63-25d16e286287"],
Cell[24607, 498, 239, 6, 32, "Input", "ExpressionUUID" -> \
"809a82b7-4875-4ac5-914c-05bb76e26e95"],
Cell[24849, 506, 277, 7, 32, "Input", "ExpressionUUID" -> \
"78fca7f2-fe26-4ae5-8aa0-c82b560baaba"],
Cell[25129, 515, 730, 18, 32, "Input", "ExpressionUUID" -> \
"1639efd2-78d6-44e7-a202-83a5c5f8ea91"],
Cell[25862, 535, 708, 17, 32, "Input", "ExpressionUUID" -> \
"5b96c8ac-ae77-4ad8-903b-0dbd682b770f"],
Cell[26573, 554, 757, 18, 32, "Input", "ExpressionUUID" -> \
"633713a8-0376-4851-9002-0d24f78d1bae"],
Cell[27333, 574, 445, 10, 32, "Input", "ExpressionUUID" -> \
"b018b808-6e70-4411-ad7d-bc947f0c5a59"],
Cell[27781, 586, 523, 12, 32, "Input", "ExpressionUUID" -> \
"1a247963-03e6-45a0-bafd-faae4428a23f"],
Cell[28307, 600, 369, 9, 32, "Input", "ExpressionUUID" -> \
"9c842f1c-eef0-4822-b8e7-ee6118183819"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28713, 614, 168, 3, 64, "Section", "ExpressionUUID" -> \
"c8ac906e-bfa9-4594-a2bc-cc0b3a88f8aa"],
Cell[28884, 619, 265, 7, 32, "Input", "ExpressionUUID" -> \
"afe3b14f-586c-4a63-9807-1168113ad276"],
Cell[29152, 628, 221, 6, 32, "Input", "ExpressionUUID" -> \
"03f67322-6b73-4ec5-b76f-521a2924b1a6"],
Cell[29376, 636, 1152, 33, 75, "Input", "ExpressionUUID" -> \
"17b3e078-71ab-4fe0-8222-c120ccdde2f5"],
Cell[30531, 671, 807, 22, 32, "Input", "ExpressionUUID" -> \
"b19dd5ec-3770-4a39-8f02-d01ff41ff57c"],
Cell[31341, 695, 322, 6, 32, "Input", "ExpressionUUID" -> \
"d66106a5-f9f9-412b-bb84-3c898fd24cc8"],
Cell[31666, 703, 197, 5, 32, "Input", "ExpressionUUID" -> \
"60bb4b65-9fb3-4765-88da-8705cd5011fb"],
Cell[31866, 710, 198, 5, 32, "Input", "ExpressionUUID" -> \
"346effa2-2c40-4a0d-b0d7-e96f1515dc5a"],
Cell[32067, 717, 9579, 216, 243, "Input", "ExpressionUUID" -> \
"ffdaed48-1505-4d28-9155-886dc05cc536"]
}, Open  ]],
Cell[CellGroupData[{
Cell[41683, 938, 225, 5, 64, "Section", "ExpressionUUID" -> \
"16135b2d-7961-4d49-b4bf-6e450dd1687f"],
Cell[41911, 945, 404, 9, 32, "Input", "ExpressionUUID" -> \
"b1d0f6e6-f1cf-4244-96a7-eb945b65dfad"],
Cell[42318, 956, 564, 17, 32, "Input", "ExpressionUUID" -> \
"c422e58d-b63c-491b-9fe6-2757c3425dd5"],
Cell[42885, 975, 863, 26, 32, "Input", "ExpressionUUID" -> \
"85aa19f1-6e57-41d6-bc84-28d9f9185553"],
Cell[43751, 1003, 237, 6, 32, "Input", "ExpressionUUID" -> \
"c411365c-b573-48bf-848f-d5c4da901291"],
Cell[43991, 1011, 360, 10, 32, "Input", "ExpressionUUID" -> \
"6f67914f-cfa0-435c-8c47-7b441b066d6a"],
Cell[44354, 1023, 298, 7, 32, "Input", "ExpressionUUID" -> \
"c373f1ec-51ba-44a8-adcb-79364037d407"],
Cell[44655, 1032, 313, 8, 32, "Input", "ExpressionUUID" -> \
"678e9cd0-2ddf-46a9-9683-d2b7012b5acc"],
Cell[44971, 1042, 491, 11, 54, "Input", "ExpressionUUID" -> \
"ab351ab1-8d15-48b1-b0d2-b06592d2fc0e"],
Cell[45465, 1055, 354, 10, 32, "Input", "ExpressionUUID" -> \
"1d7ab097-5485-4dae-8d72-6abceeaa2070"],
Cell[45822, 1067, 552, 12, 32, "Input", "ExpressionUUID" -> \
"d2172e26-65d2-472d-abc7-dd67acad6631"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

